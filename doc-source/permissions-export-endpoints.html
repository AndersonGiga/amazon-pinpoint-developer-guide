<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>IAM Role for Exporting
         Endpoints or
         Segments - Amazon Pinpoint
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="home" href="#top" />
      <link rel="up" href="permissions.html" title="Permissions" />
      <link rel="prev" href="permissions-import-segment.html" title="IAM Role for Importing Endpoints or&#xA;            Segments" />
      <link rel="next" href="permissions-streams.html" title="IAM Role for Streaming Events to Kinesis" />
      <meta name="description" content="Create an IAM role that enables you to export Amazon Pinpoint segment information to Amazon Simple Storage Service (Amazon S3)." />
      <meta name="keywords" content="Pinpoint,Amazon Pinpoint,Customer engagement,Segmentation,Campaigns,Metrics" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="Amazon Pinpoint" />
      <meta name="guide" content="Developer Guide" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <link rel="icon" type="image/ico" href="images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/pinpoint/latest/developerguide/permissions-export-endpoints.html" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />
      <link rel="stylesheet" type="text/css" href="font/css/font-awesome.min.css" />
      <link rel="stylesheet" type="text/css" href="css/google-font.css" />
      <link id="code-style" rel="stylesheet" type="text/css" href="css/code/light.css" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />
      <link rel="stylesheet" type="text/css" href="css/colorbox.css" />
      <link rel="stylesheet" type="text/css" href="css/awsdocs.css?v=20181221" /><script type="text/javascript" src="js/highlight.pack.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/jquery-ui.min.js"></script><script type="text/javascript" src="js/jquery.colorbox.js"></script><script type="text/javascript" src="js/awsdocs.min.js?v=20181221"></script></head>
   <body id="top">
      <div xmlns:db="http://docbook.org/ns/docbook" id="aws-nav" class="aws-nav-header">
         <div class="aws-nav-header-left">
            <div class="aws-nav-logo">
               <!--aws_logo_105x39.png--><a href="http://aws.amazon.com"><img src="images/aws_logo_105x39.png" alt="Amazon Web Services" /></a></div>
         </div>
         <div id="aws-nav-header-right" class="aws-nav-header-right">
            <div class="aws-nav-cta-button-outer"><a id="aws-nav-cta-button" class="aws-nav-button" href="https://console.aws.amazon.com/console/home">Sign In to the Console</a></div>
            <div class="aws-nav-popover-trigger" data-dropdown="aws-nav-dropdown-lang"><select id="languageSelection" onchange="SelectLanguage()">
                  <option value="/de_de/pinpoint/latest/developerguide/permissions-export-endpoints.html">Deutsch</option>
                  <option value="/en_us/pinpoint/latest/developerguide/permissions-export-endpoints.html" selected="selected">English</option>
                  <option value="/es_es/pinpoint/latest/developerguide/permissions-export-endpoints.html">Español</option>
                  <option value="/fr_fr/pinpoint/latest/developerguide/permissions-export-endpoints.html">Français</option>
                  <option value="/it_it/pinpoint/latest/developerguide/permissions-export-endpoints.html">Italiano</option>
                  <option value="/ja_jp/pinpoint/latest/developerguide/permissions-export-endpoints.html">日本語</option>
                  <option value="/ko_kr/pinpoint/latest/developerguide/permissions-export-endpoints.html">한국어</option>
                  <option value="/pt_br/pinpoint/latest/developerguide/permissions-export-endpoints.html">Português</option>
                  <option value="/zh_cn/pinpoint/latest/developerguide/permissions-export-endpoints.html">中文 (简体)</option>
                  <option value="/zh_tw/pinpoint/latest/developerguide/permissions-export-endpoints.html">中文 (繁體)</option></select></div><a class="btn btn-kindle-link" id="kindle-link-top" target="_blank" href="http://www.amazon.com/dp/B07JKHTQVP" title="Open Kindle"></a><a class="btn btn-pdf-link" id="pdf-link-top" href="pinpoint-dg.pdf#permissions-export-endpoints" target="_blank" title="Open PDF"></a><a class="btn btn-github-link" id="github-link-top" href="https://github.com/awsdocs/amazon-pinpoint-developer-guide/tree/master/doc-source/permissions-export-endpoints.md" target="_blank" title="Edit on GitHub"></a><div id="aws-nav-quicklinks-separator" class="aws-nav-quicklinks-separator">
               <div class="aws-nav-left"></div>
               <div class="aws-nav-right"></div>
            </div>
         </div>
      </div>
      <div id="content-container">
         <div id="left-column">
            <div id="left-col-header">
               <div xmlns:db="http://docbook.org/ns/docbook" id="left-col-top-content">
                  <div id="service-name">Amazon Pinpoint </div>
                  <div id="search"><i id="search-icon" class="fa fa-search fa-2x"></i></div>
                  <div id="guide-info">Developer Guide
                     <div id="content-button"><i id="toggle-contents" class="fa fa-bars"></i></div>
                  </div>
               </div>
               <form id="finegrainedSearch" method="get" onsubmit="return searchFormSubmit(this);" action="/search/doc-search.html">
                  <div id="search-form"><select id="search-select" name="searchPath">
                        <option value="all">Entire Site</option>
                        <option value="AWSMarketplace">AMIs from AWS Marketplace</option>
                        <option value="amis">AMIs from All Sources</option>
                        <option value="articles">Articles &amp; Tutorials</option>
                        <option value="products_and_info">AWS Product Information</option>
                        <option value="case_studies">Case Studies</option>
                        <option value="customerapps">Customer Apps</option>
                        <option value="documentation">Documentation</option>
                        <option value="documentation-product">Documentation - This Product</option>
                        <option value="documentation-guide" selected="selected">Documentation - This Guide</option>
                        <option value="datasets">Public Data Sets</option>
                        <option value="releasenotes">Release Notes</option>
                        <option value="solution_providers">Partners</option>
                        <option value="code">Sample Code &amp; Libraries</option></select><br /><input id="search-query" name="searchQuery" type="text" placeholder="Search" /><input id="search-button" src="images/search-button.png" alt="Go" type="image" /></div><input type="hidden" name="this_doc_product" id="this_doc_product" value="Amazon Pinpoint" /><input type="hidden" name="this_doc_guide" id="this_doc_guide" value="Developer Guide" /><input type="hidden" name="doc_locale" value="en_us" /></form>
            </div>
            <div id="toc"></div>
         </div>
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> » <a href="/pinpoint/index.html">Amazon Pinpoint</a> » <a href="index.html">Developer Guide</a> » <a href="permissions.html">Permissions</a> » <span class="breadcrumb">IAM Role for Exporting
                                    Endpoints or
                                    Segments</span></div>
                           </td>
                        </tr>
                     </table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="permissions-export-endpoints">IAM Role for Exporting
                        Endpoints or
                        Segments
                     </h1>
                     <p>You can obtain a list of endpoints by creating an export job. When you create an export
                        job, you have to specify a project ID, and you can optionally specify a segment ID.
                        Amazon Pinpoint then exports a list of the endpoints associated with the project or
                        segment to an
                        Amazon Simple Storage Service (Amazon S3) bucket. The resulting file contains a JSON-formatted
                        list of endpoints and
                        their attributes, such as channel, address, opt-in/opt-out status, creation date,
                        and
                        endpoint ID. 
                     </p>
                     <p>To create an export job, you have to configure an IAM role that allows Amazon Pinpoint
                        to write to
                        an Amazon S3 bucket. The process of configuring the role consists of two steps:
                     </p>
                     <div class="orderedlist">
                        
                        
                        
                        <ol>
                           <li>
                              
                              <p>Create an IAM policy that allows an entity (in this case, Amazon Pinpoint) to write
                                 to a
                                 specific Amazon S3 bucket.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>Create an IAM role and attach the policy to it.</p>
                              
                           </li>
                        </ol>
                     </div>
                     <p>This section contains procedures for completing both of these steps. These procedures
                        assume that you've already created an Amazon S3 bucket, and a folder in that bucket,
                        for storing
                        exported segments. For more information about creating buckets, see <a href="https://docs.aws.amazon.com/AmazonS3/latest/gsg/CreatingABucket.html">Create a Bucket</a> in the
                        <em>Amazon Simple Storage Service Getting Started Guide</em>. 
                     </p>
                     <p>These procedures also assume that you've already installed and configured the AWS
                        CLI. For
                        more information about setting up the AWS CLI, see <a href="https://docs.aws.amazon.com/cli/latest/userguide/installing.html">Installing the AWS Command Line Interface</a> in the <em>AWS Command Line Interface User Guide</em>.
                     </p>
                     
                     <h2 id="permissions-export-endpoints-create-policy">Step 1: Create the IAM
                        Policy
                     </h2>
                     
                     <p>An IAM policy defines the permissions for an entity, such as an identity or
                        resource. To create a role for exporting Amazon Pinpoint endpoints, you have to create
                        a policy
                        that grants permission to write to a specific folder in a specific Amazon S3 bucket.
                        The
                        following policy example follows the security practice of granting least
                        privilege—that is, it grants only the permissions that are required to perform a
                        single task.
                     </p>
                     
                     <p class="title"><b>To create the IAM policy</b></p>
                     <ol>
                        <li>
                           
                           <p>In a text editor, create a new file. Paste the following code into the
                              file:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowUserToSeeBucketListInTheConsole",
            "Action": [
                "s3:ListAllMyBuckets",
                "s3:GetBucketLocation"
            ],
            "Effect": "Allow",
            "Resource": [ "arn:aws:s3:::*" ]
        },
        {
            "Sid": "AllowRootAndHomeListingOfBucket",
            "Action": [
                "s3:ListBucket"
            ],
            "Effect": "Allow",
            "Resource": [ "arn:aws:s3:::<em class="replaceable"><code>example-bucket</code></em>" ],
            "Condition": {
                "StringEquals": {
                    "s3:delimiter": [ "/" ],
                    "s3:prefix": [
                        "",
                        "<em class="replaceable"><code>Exports</code></em>/"
                    ]
                }
            }
        },
        {
            "Sid": "AllowListingOfUserFolder",
            "Action": [
                "s3:ListBucket"
            ],
            "Effect": "Allow",
            "Resource": [ "arn:aws:s3:::<em class="replaceable"><code>example-bucket</code></em>" ],
            "Condition": {
                "StringLike": {
                    "s3:prefix": [
                        "<em class="replaceable"><code>Exports</code></em>/*"
                    ]
                }
            }    
        },
        {
            "Sid": "AllowAllS3ActionsInUserFolder",
            "Action": [ "s3:*" ],
            "Effect": "Allow",
            "Resource": [ "arn:aws:s3:::<em class="replaceable"><code>example-bucket</code></em>/<em class="replaceable"><code>Exports</code></em>/*" ]
        }
    ]
}</code></pre>
                           <p>In the preceding code, replace all instances of
                              <em class="replaceable"><code>example-bucket</code></em> with the name of the Amazon S3 bucket
                              that contains the folder that you want to export the segment information into.
                              Also, replace all instances of <em class="replaceable"><code>Exports</code></em> with the name
                              of the folder itself.
                           </p>
                           
                           <p>When you finish, save the file as <code>s3policy.json</code>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>At the command line, navigate to the directory where
                              <code>s3policy.json</code> is located. Then type the following
                              command to create the policy:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws iam create-policy --policy-name s3ExportPolicy --policy-document file://<code>s3policy.json</code></code></pre>
                           <p>If the policy was created successfully, you see output similar to the
                              following:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
    "Policy": {
        "CreateDate": "2018-04-11T18:44:34.805Z",
        "IsAttachable": true,
        "DefaultVersionId": "v1",
        "AttachmentCount": 0,
        "PolicyId": "ANPAJ2YJQRJCG3EXAMPLE",
        "UpdateDate": "2018-04-11T18:44:34.805Z",
        "Arn": "arn:aws:iam::123456789012:policy/s3ExportPolicy",
        "PolicyName": "s3ExportPolicy",
        "Path": "/"
    }
}</code></pre>
                           <p>Copy the Amazon Resource Name (ARN) of the policy
                              (<code class="code">arn:aws:iam::123456789012:policy/s3ExportPolicy</code> in the
                              preceding example). In the next section, you must supply this ARN when you
                              create the role.
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>If you see a message stating that your account isn't authorized to perform
                                 the <code class="code">CreatePolicy</code> operation, then you need to attach a policy to
                                 your user account that lets you create new IAM policies and roles. For
                                 more information, see <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_manage-attach-detach.html#attach-managed-policy-console">Adding and Removing IAM Identity Permissions</a> in the
                                 <em>IAM User Guide</em>.
                              </p>
                           </div>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="permissions-export-endpoints-create-role">Step 2: Create the IAM Role</h2>
                     
                     <p>Now that you've created an IAM policy, you can create a role and attach the policy
                        to it. Each IAM role contains a <em>trust policy</em>—a set of rules
                        that specifies which entities are allowed to assume the role. In this section, you
                        create a trust policy that allows Amazon Pinpoint to assume the role. Next, you create
                        the role
                        itself, and then attach the policy that you created in the previous section.
                     </p>
                     
                     <p class="title"><b>To create the IAM role</b></p>
                     <ol>
                        <li>
                           
                           <p>In a text editor, create a new file. Paste the following code into the
                              file:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
    "Version":"2012-10-17",
    "Statement":[
        {
            "Effect":"Allow",
            "Principal":{
                "Service":"pinpoint.amazonaws.com"
            },
            "Action":"sts:AssumeRole"
        }
    ]
}</code></pre>
                           <p>Save the file as <code>trustpolicy.json</code>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>At the command line, navigate to the directory where
                              <code>trustpolicy.json</code> is located. Then type the following
                              command to create a new role:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws iam create-role --role-name s3ExportRole --assume-role-policy-document file://<code>trustpolicy.json</code></code></pre>
                           <p>If the command runs successfully, you see output similar to the
                              following:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{                                                          
    "Role": {                                              
        "RoleName": "s3ExportRole",                           
        "AssumeRolePolicyDocument": {                      
            "Version": "2012-10-17",                       
            "Statement": [                                 
                {                                          
                    "Effect": "Allow",                     
                    "Principal": {                         
                        "Service": "pinpoint.amazonaws.com"
                    },                                     
                    "Action": "sts:AssumeRole"             
                }                                          
            ]                                              
        },                                                 
        "RoleId": "AROAICPO353GIPEXAMPLE",                 
        "Arn": "arn:aws:iam::123456789012:role/s3ExportRole", 
        "CreateDate": "2018-04-11T18:52:36.712Z",          
        "Path": "/"                                        
    }                                                      
}</code></pre>
                           </li>
                        <li>
                           
                           <p>At the command line, type the following command to attach the policy that you
                              created in the previous section to the role that you just created:
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">aws iam attach-role-policy --policy-arn <em class="replaceable"><code>arn:aws:iam::123456789012:policy/s3ExportPolicy</code></em> --role-name s3ExportRole</code></pre>
                           <p>In the preceding command, replace
                              <em class="replaceable"><code>arn:aws:iam::123456789012:policy/s3ExportPolicy</code></em>
                              with the ARN of the policy that you created in the previous section.
                           </p>
                           
                        </li>
                     </ol>
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="permissions-import-segment.html">« Previous </a><a class="awstoc" accesskey="n" href="permissions-streams.html">Next »</a></div>
                     <div id="copyright-main-footer">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Step 1: Create the IAM&#xA;                Policy"><a class="pagetoc" href="#permissions-export-endpoints-create-policy">Step 1: Create the IAM
                              Policy</a></li>
                        <li class="pagetoc" name="Step 2: Create the IAM Role"><a class="pagetoc" href="#permissions-export-endpoints-create-role">Step 2: Create the IAM Role</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using our site, you consent
            to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      <div id="footer">
         <div id="footer_short_fb" class="hide" title="Feedback"><a target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/permissions-export-endpoints.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=permissions-export-endpoints"><i class="awsdocs-footer-text fa fa-envelope-o"></i></a></div>
         <div id="footer_toggle" class="mediaobject">
            <div id="footer_toggle_img" class="awsdocs-footer-text fa fa-caret-down"></div>
            <div id="footer_toggle_img_collapse" class="hide awsdocs-footer-text fa fa-caret-right"></div>
         </div>
         <div id="footer-left"><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/terms">Terms of Use</a><span class="awsdocs-footer-text"> | </span><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/privacy">Privacy</a><span class="awsdocs-footer-text"> | </span><span class="awsdocs-footer-text">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></div>
         <div id="footer-right">
            <div id="feedback">
               <div id="forums"><a id="forum_link" target="_blank" href="http://forums.aws.amazon.com/forum.jspa?forumID=225" class="awsdocs-footer-text">Have a question? Try the Forums.</a></div>
               <div id="feedback-message" class="awsdocs-footer-text">Did this page help you?</div>
               <div id="feedback-yesno-buttons"><a class="awstoc btn btn-default" target="_blank" href="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/permissions-export-endpoints.html">Yes</a><a class="awstoc btn btn-default" target="_blank" href="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/permissions-export-endpoints.html">No</a></div>
               <div id="feedback-feedback-button"><a class="awstoc btn btn-default" target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/permissions-export-endpoints.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=permissions-export-endpoints">Feedback</a></div>
            </div>
         </div>
      </div>
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Pinpoint';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   </body>
</html>