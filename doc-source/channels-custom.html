<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Creating Custom Channels with AWS Lambda - Amazon Pinpoint</title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="home" href="#top" />
      <link rel="up" href="welcome.html" title="What Is Amazon Pinpoint?" />
      <link rel="prev" href="limits.html" title="Limits in Amazon Pinpoint" />
      <link rel="next" href="doc-history.html" title="Document History for Amazon Pinpoint" />
      <meta name="description" content="Use an AWS Lambda function to create a custom messaging channel for Amazon Pinpoint." />
      <meta name="keywords" content="Pinpoint,Amazon Pinpoint,Customer engagement,Segmentation,Campaigns,Metrics" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="Amazon Pinpoint" />
      <meta name="guide" content="Developer Guide" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <link rel="icon" type="image/ico" href="images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/pinpoint/latest/developerguide/channels-custom.html" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />
      <link rel="stylesheet" type="text/css" href="font/css/font-awesome.min.css" />
      <link rel="stylesheet" type="text/css" href="css/google-font.css" />
      <link id="code-style" rel="stylesheet" type="text/css" href="css/code/light.css" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />
      <link rel="stylesheet" type="text/css" href="css/colorbox.css" />
      <link rel="stylesheet" type="text/css" href="css/awsdocs.css?v=20181221" /><script type="text/javascript" src="js/highlight.pack.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/jquery-ui.min.js"></script><script type="text/javascript" src="js/jquery.colorbox.js"></script><script type="text/javascript" src="js/awsdocs.min.js?v=20181221"></script></head>
   <body id="top">
      <div xmlns:db="http://docbook.org/ns/docbook" id="aws-nav" class="aws-nav-header">
         <div class="aws-nav-header-left">
            <div class="aws-nav-logo">
               <!--aws_logo_105x39.png--><a href="http://aws.amazon.com"><img src="images/aws_logo_105x39.png" alt="Amazon Web Services" /></a></div>
         </div>
         <div id="aws-nav-header-right" class="aws-nav-header-right">
            <div class="aws-nav-cta-button-outer"><a id="aws-nav-cta-button" class="aws-nav-button" href="https://console.aws.amazon.com/console/home">Sign In to the Console</a></div>
            <div class="aws-nav-popover-trigger" data-dropdown="aws-nav-dropdown-lang"><select id="languageSelection" onchange="SelectLanguage()">
                  <option value="/de_de/pinpoint/latest/developerguide/channels-custom.html">Deutsch</option>
                  <option value="/en_us/pinpoint/latest/developerguide/channels-custom.html" selected="selected">English</option>
                  <option value="/es_es/pinpoint/latest/developerguide/channels-custom.html">Español</option>
                  <option value="/fr_fr/pinpoint/latest/developerguide/channels-custom.html">Français</option>
                  <option value="/it_it/pinpoint/latest/developerguide/channels-custom.html">Italiano</option>
                  <option value="/ja_jp/pinpoint/latest/developerguide/channels-custom.html">日本語</option>
                  <option value="/ko_kr/pinpoint/latest/developerguide/channels-custom.html">한국어</option>
                  <option value="/pt_br/pinpoint/latest/developerguide/channels-custom.html">Português</option>
                  <option value="/zh_cn/pinpoint/latest/developerguide/channels-custom.html">中文 (简体)</option>
                  <option value="/zh_tw/pinpoint/latest/developerguide/channels-custom.html">中文 (繁體)</option></select></div><a class="btn btn-kindle-link" id="kindle-link-top" target="_blank" href="http://www.amazon.com/dp/B07JKHTQVP" title="Open Kindle"></a><a class="btn btn-pdf-link" id="pdf-link-top" href="pinpoint-dg.pdf#channels-custom" target="_blank" title="Open PDF"></a><a class="btn btn-github-link" id="github-link-top" href="https://github.com/awsdocs/amazon-pinpoint-developer-guide/tree/master/doc-source/channels-custom.md" target="_blank" title="Edit on GitHub"></a><div id="aws-nav-quicklinks-separator" class="aws-nav-quicklinks-separator">
               <div class="aws-nav-left"></div>
               <div class="aws-nav-right"></div>
            </div>
         </div>
      </div>
      <div id="content-container">
         <div id="left-column">
            <div id="left-col-header">
               <div xmlns:db="http://docbook.org/ns/docbook" id="left-col-top-content">
                  <div id="service-name">Amazon Pinpoint </div>
                  <div id="search"><i id="search-icon" class="fa fa-search fa-2x"></i></div>
                  <div id="guide-info">Developer Guide
                     <div id="content-button"><i id="toggle-contents" class="fa fa-bars"></i></div>
                  </div>
               </div>
               <form id="finegrainedSearch" method="get" onsubmit="return searchFormSubmit(this);" action="/search/doc-search.html">
                  <div id="search-form"><select id="search-select" name="searchPath">
                        <option value="all">Entire Site</option>
                        <option value="AWSMarketplace">AMIs from AWS Marketplace</option>
                        <option value="amis">AMIs from All Sources</option>
                        <option value="articles">Articles &amp; Tutorials</option>
                        <option value="products_and_info">AWS Product Information</option>
                        <option value="case_studies">Case Studies</option>
                        <option value="customerapps">Customer Apps</option>
                        <option value="documentation">Documentation</option>
                        <option value="documentation-product">Documentation - This Product</option>
                        <option value="documentation-guide" selected="selected">Documentation - This Guide</option>
                        <option value="datasets">Public Data Sets</option>
                        <option value="releasenotes">Release Notes</option>
                        <option value="solution_providers">Partners</option>
                        <option value="code">Sample Code &amp; Libraries</option></select><br /><input id="search-query" name="searchQuery" type="text" placeholder="Search" /><input id="search-button" src="images/search-button.png" alt="Go" type="image" /></div><input type="hidden" name="this_doc_product" id="this_doc_product" value="Amazon Pinpoint" /><input type="hidden" name="this_doc_guide" id="this_doc_guide" value="Developer Guide" /><input type="hidden" name="doc_locale" value="en_us" /></form>
            </div>
            <div id="toc"></div>
         </div>
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> » <a href="/pinpoint/index.html">Amazon Pinpoint</a> » <a href="index.html">Developer Guide</a> » <span class="breadcrumb">Creating Custom Channels with AWS Lambda</span></div>
                           </td>
                        </tr>
                     </table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="channels-custom">Creating Custom Channels with AWS Lambda</h1>
                     <div class="table">
                        <div class="table-contents">
                           <table id="w230aac40b3">
                              
                              <tr>
                                 
                                 <td bgcolor="#FFFCEC"><em><b>This is prerelease documentation for a feature in public beta release. It is subject
                                          to change.</b></em></td>
                                 
                              </tr>
                              
                           </table>
                        </div>
                     </div>
                     <p>Amazon Pinpoint supports messaging channels for mobile push, email, and SMS. However,
                        some
                        messaging use cases might require unsupported channels. For example, you might want
                        to send a message to an instant messaging service, such as Facebook Messenger, or
                        you might want to display a notification within your web application. In such cases,
                        you can use AWS Lambda to create a custom channel that performs the message delivery
                        outside of Amazon Pinpoint.
                     </p>
                     <p>AWS Lambda is a compute service that you can use to run code without provisioning
                        or
                        managing servers. You package your code and upload it to Lambda as <em>Lambda functions</em>. Lambda runs a function when the
                        function is invoked, which might be done manually by you or automatically in
                        response to events.
                     </p>
                     <p>For more information, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-introduction-function.html">Lambda Functions</a> in the <em>AWS Lambda Developer Guide</em>.
                     </p>
                     <p>To create a custom channel, you define a Lambda function that handles the message
                        delivery for an Amazon Pinpoint campaign. Then, you assign the function to a campaign
                        by
                        defining the campaign's <a href="https://docs.aws.amazon.com/pinpoint/latest/apireference/rest-api-campaign.html#rest-api-campaign-attributes-campaignhook-table"><code class="code">CampaignHook</code></a> settings. These settings include
                        the Lambda function name and the <code class="code">CampaignHook</code> mode. By setting the mode
                        to <code class="code">DELIVERY</code>, you specify that the Lambda function handles the message
                        delivery instead of Amazon Pinpoint.
                     </p>
                     <p>A Lambda function that you assign to a campaign is referred to as an Amazon Pinpoint
                        <em>extension</em>.
                     </p>
                     <p>With the <code class="code">CampaignHook</code> settings defined, Amazon Pinpoint automatically invokes the
                        Lambda function when it runs the campaign, without sending the campaign's message
                        to
                        a standard channel. Instead, Amazon Pinpoint sends <em>event
                           data</em> about the message delivery to the function, and it allows
                        the function to handle the delivery. The event data includes the message body and
                        the list of endpoints to which the message should be delivered.
                     </p>
                     <p>After Amazon Pinpoint successfully invokes the function, it generates a successful
                        send event
                        for the campaign.
                     </p>
                     <div class="aws-note">
                        <p class="aws-note">Note</p>
                        <p>You can also use the <code class="code">CampaignHook</code> settings to assign a Lambda
                           function that modifies and returns a campaign's segment before Amazon Pinpoint
                           delivers the campaign's message. For more information, see <a href="segments-dynamic.html">Customizing Segments with AWS Lambda</a>.
                        </p>
                     </div>
                     <p>To create a custom channel with AWS Lambda, first create a function that accepts the
                        event data sent by Amazon Pinpoint and handles the message delivery. Then, authorize
                        Amazon Pinpoint to
                        invoke the function by assigning a Lambda function policy. Finally, assign the
                        function to one or more campaigns by defining <code class="code">CampaignHook</code>
                        settings.
                     </p>
                     
                     <h2 id="channels-custom-event-data">Event Data</h2>
                     
                     <p>When Amazon Pinpoint invokes your Lambda function, it provides the following payload
                        as
                        the event data:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  "MessageConfiguration": {<em class="replaceable"><code>Message configuration</code></em>}
  "ApplicationId": <em class="replaceable"><code>ApplicationId</code></em>,
  "CampaignId": <em class="replaceable"><code>CampaignId</code></em>,
  "TreatmentId": <em class="replaceable"><code>TreatmentId</code></em>,
  "ActivityId": <em class="replaceable"><code>ActivityId</code></em>,
  "ScheduledTime": <em class="replaceable"><code>Scheduled Time</code></em>,
  "Endpoints": {
    <em class="replaceable"><code>EndpointId</code></em>: {<em class="replaceable"><code>Endpoint definition</code></em>}
    . . .
  }
}</code></pre>
                     
                     <p>The event data provides the following attributes:</p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><code class="code">MessageConfiguration</code> – Has the same
                                 structure as the <a href="https://docs.aws.amazon.com/pinpoint/latest/apireference/rest-api-messages.html#rest-api-messages-attributes-directmessageconfiguration-table"><code class="code">DirectMessageConfiguration</code></a>
                                 in the <code class="code">Messages</code> resource in the Amazon Pinpoint API.
                                 
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">ApplicationId</code> – The ID of the Amazon Pinpoint
                                 project to which the campaign belongs.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">CampaignId</code> – The ID of the Amazon Pinpoint project
                                 for which the function is invoked.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">TreatmentId</code> – The ID of a campaign
                                 variation used for A/B testing.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">ActivityId</code> – The ID of the activity being
                                 performed by the campaign.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">ScheduledTime</code> – The schedule time at which
                                 the campaign's messages are delivered in ISO 8601
                                 format.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">Endpoints</code> – A map that associates endpoint
                                 IDs with endpoint definitions. Each event data payload
                                 contains up to 50 endpoints. If the campaign segment
                                 contains more than 50 endpoints, Amazon Pinpoint invokes the function
                                 repeatedly, with up to 50 endpoints at a time, until all
                                 endpoints have been processed. 
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <h2 id="channels-custom-lambda-create">Creating a Lambda
                        Function
                     </h2>
                     
                     <p>To create a Lambda function, refer to <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-app.html">Building Lambda Functions</a> in the <em>AWS Lambda Developer Guide</em>.
                     </p>
                     
                     
                     <h3 id="channels-custom-lambda-example">Example Lambda
                        Function
                     </h3>
                     
                     <p>The following example Lambda function receives event data when Amazon Pinpoint
                        runs a campaign, and it sends the campaign's message to Facebook
                        Messenger:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="javascript ">"use strict";

var https = require("https");
var q = require("q");

var VERIFY_TOKEN = "<em class="replaceable"><code>my_token</code></em>";
var PAGE_ACCESS_TOKEN = "EAF...DZD";
/* this constant can be put in a constants file and shared between this function and your Facebook Messenger webhook code */
var FACEBOOK_MESSENGER_PSID_ATTRIBUTE_KEY = "facebookMessengerPsid";

exports.handler = function(event, context, callback) {

    var deliverViaMessengerPromises = [];

    if (event.Message &amp;&amp; event.Endpoints) {
        for (var endpoint in event.Endpoints) {
            if (isFbookMessengerActive(event.Endpoints[endpoint])) {
                deliverViaMessengerPromises.push(deliverViaMessenger(event.Message, event.Endpoints[endpoint].User));
            }
        }
    }

    /* default OK response */
    var response = {
        body: "ok",
        statusCode: 200
    };

    if (deliverViaMessengerPromises.length &gt; 0) {
        q.all(deliverViaMessengerPromises).done(function() {
            callback(null, response);
        });
    } else {
        callback(null, response);
    }

}

/**
Example Pinpoint Endpoint User object where we've added custom attribute facebookMessengerPsid to store the PSID needed by Facebook's API
{
    "UserId": "7a9870b7-493c-4521-b0ca-08bbbc36e595",
    "UserAttributes": {
        "facebookMessengerPsid": [ "1667566386619741" ]
    }
}
**/
function isFbookMessengerActive(endpoint) {
    return endpoint.User &amp;&amp; endpoint.User.UserAttributes &amp;&amp; endpoint.User.UserAttributes[FACEBOOK_MESSENGER_PSID_ATTRIBUTE_KEY];
}

/**
Sample message object from Pinpoint. This sample was an SMS so it has "smsmessage" attribute but this will vary for each messaging channel
{
    "smsmessage": {
        "body": "<em class="replaceable"><code>This message should be intercepted by a campaign hook.</code></em>"
    }
}
**/
function deliverViaMessenger(message, user) {
    var deferred = q.defer();

    var messageText = message["smsmessage"]["body"];
    var pinpointUserId = user.UserId;
    var facebookPsid = user.UserAttributes[FACEBOOK_MESSENGER_PSID_ATTRIBUTE_KEY][0];
    console.log("Sending message for user %s and page %s with message:", pinpointUserId, facebookPsid, messageText);

    var messageData = {
        recipient: {
            id: facebookPsid
        },
        message: {
            text: messageText
        }
    };

    var body = JSON.stringify(messageData);
    var path = "/v2.6/me/messages?access_token=" + PAGE_ACCESS_TOKEN;
    var options = {
        host: "graph.facebook.com",
        path: path,
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        }
    };

    var req = https.request(options, httpsCallback);

    req.on("error", function(e) {
        console.log("Error posting to Facebook Messenger: " + e);
        deferred.reject(e);
    });

    req.write(body);
    req.end();

    return deferred.promise;

    function httpsCallback(response) {
        var str = "";
        response.on("data", function(chunk) {
            str += chunk;
        });
        response.on("end", function() {
            console.log(str);
            deferred.resolve(response);
        });
    }
}
</code></pre>
                     
                     
                     <h2 id="segments-dynamic-lambda-trust-policy">Assigning a Lambda
                        Function Policy
                     </h2>
                     
                     <p>Before you can use your Lambda function to process your endpoints, you must
                        authorize Amazon Pinpoint to invoke your Lambda function. To grant invocation
                        permission, assign a <em>Lambda function
                           policy</em> to the function. A Lambda function policy is a
                        resource-based permissions policy that designates which entities can use
                        your function and what actions those entities can take.
                     </p>
                     
                     <p>For more information, see <a href="https://docs.aws.amazon.com/lambda/latest/dg/access-control-resource-based.html">Using
                           Resource-Based Policies for AWS Lambda (Lambda Function
                           Policies)</a> in the <em>AWS Lambda Developer Guide</em>.
                     </p>
                     
                     
                     <h3 id="segments-dynamic-lambda-trust-policy-example">Example Function Policy</h3>
                     
                     <p>The following policy grants permission to the Amazon Pinpoint service principal
                        to use the <code class="code">lambda:InvokeFunction</code> action:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
  "Sid": "<em class="replaceable"><code>sid</code></em>",
  "Effect": "Allow",
  "Principal": {
    "Service": "pinpoint.us-east-1.amazonaws.com"
  },
  "Action": "lambda:InvokeFunction",
  "Resource": "{arn:aws:lambda:us-east-1:<em class="replaceable"><code>account-id</code></em>:function:<em class="replaceable"><code>function-name</code></em>}",
  "Condition": {
    "ArnLike": {
      "AWS:SourceArn": "arn:aws:mobiletargeting:us-east-1:<em class="replaceable"><code>account-id</code></em>:/apps/<em class="replaceable"><code>application-id</code></em>/campaigns/<em class="replaceable"><code>campaign-id</code></em>"
    }
  }
}</code></pre>
                     <p>Your function policy requires a <code class="code">Condition</code> block that
                        includes an <code class="code">AWS:SourceArn</code> key. This code states which
                        Amazon Pinpoint campaign is allowed to invoke the function. In this example,
                        the policy grants permission to only a single campaign ID. To write
                        a more generic policy, use multi-character match wildcards (*). For
                        example, you can use the following <code class="code">Condition</code> block to
                        allow any Amazon Pinpoint campaign in your AWS account to invoke the
                        function:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">"Condition": {
  "ArnLike": {
    "AWS:SourceArn": "arn:aws:mobiletargeting:us-east-1:<em class="replaceable"><code>account-id</code></em>:/apps/*/campaigns/*"
  }
}</code></pre>
                     
                     
                     <h3 id="channels-custom-lambda-trust-policy-assign">Granting Amazon Pinpoint Invocation Permission</h3>
                     
                     <p>You can use the AWS Command Line Interface (AWS CLI) to add permissions to the Lambda
                        function policy assigned to your Lambda function. To allow Amazon Pinpoint to
                        invoke a function, use the Lambda <a href="https://docs.aws.amazon.com/cli/latest/reference/lambda/add-permission.html"><code class="code">add-permission</code></a> command, as
                        shown by the following example:
                     </p>
                     
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="prompt" copy="false">$ </code><strong class="userinput"><code>aws lambda add-permission \</code></strong>
<code class="prompt" copy="false">&gt; </code><strong class="userinput"><code>--function-name <em class="replaceable"><code>function-name</code></em> \</code></strong>
<code class="prompt" copy="false">&gt; </code><strong class="userinput"><code>--statement-id <em class="replaceable"><code>sid</code></em> \</code></strong>
<code class="prompt" copy="false">&gt; </code><strong class="userinput"><code>--action lambda:InvokeFunction \</code></strong>
<code class="prompt" copy="false">&gt; </code><strong class="userinput"><code>--principal pinpoint.us-east-1.amazonaws.com \</code></strong>
<code class="prompt" copy="false">&gt; </code><strong class="userinput"><code>--source-arn arn:aws:mobiletargeting:us-east-1:<em class="replaceable"><code>account-id</code></em>:/apps/<em class="replaceable"><code>application-id</code></em>/campaigns/<em class="replaceable"><code>campaign-id</code></em></code></strong></code></pre>
                     <p>If you want to provide a campaign ID for the <code class="code">--source-arn</code>
                        parameter, you can look up your campaign IDs by using the Amazon Pinpoint
                        <a href="https://docs.aws.amazon.com/cli/latest/reference/pinpoint/get-campaigns.html"><code class="code">get-campaigns</code></a> command with the
                        AWS CLI. This command requires an <code class="code">--application-id</code>
                        parameter. To look up your application IDs, sign in to the Amazon Pinpoint
                        console at <a href="https://console.aws.amazon.com/pinpoint/" target="_blank">https://console.aws.amazon.com/pinpoint/</a>, and go to the
                        <b>Projects</b> page. The console shows an
                        <b>ID</b> for each project, which is the
                        project's application ID.
                     </p>
                     
                     <p>When you run the Lambda <code class="code">add-permission</code> command, AWS Lambda
                        returns the following output:
                     </p>
                     <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight"><code class="computeroutput" copy="false">{
  "Statement": "{\"Sid\":\"sid\",
    \"Effect\":\"Allow\",
    \"Principal\":{\"Service\":\"pinpoint.us-east-1.amazonaws.com\"},
    \"Action\":\"lambda:InvokeFunction\",
    \"Resource\":\"arn:aws:lambda:us-east-1:111122223333:function:function-name\",
    \"Condition\":
      {\"ArnLike\":
        {\"AWS:SourceArn\":
         \"arn:aws:mobiletargeting:us-east-1:111122223333:/apps/application-id/campaigns/campaign-id\"}}}"
}</code></code></pre>
                     <p>The <code class="code">Statement</code> value is a JSON string version of the
                        statement added to the Lambda function policy.
                     </p>
                     
                     
                     
                     <h2 id="channels-custom-assign">Assigning a Lambda Function to a
                        Campaign
                     </h2>
                     
                     <p>You can assign a Lambda function to an individual Amazon Pinpoint campaign. Or, you
                        can
                        set the Lambda function as the default used by all campaigns for a project,
                        except for those campaigns to which you assign a function
                        individually.
                     </p>
                     
                     <p>To assign a Lambda function to an individual campaign, use the Amazon Pinpoint API
                        to
                        create or update a <a href="https://docs.aws.amazon.com/pinpoint/latest/apireference/rest-api-campaigns.html"><code class="code">Campaign</code></a> object, and define its
                        <code class="code">CampaignHook</code> attribute. To set a Lambda function as the
                        default for all campaigns in a project, create or update the <a href="https://docs.aws.amazon.com/pinpoint/latest/apireference/rest-api-settings.html"><code class="code">Settings</code></a> resource for that project, and define
                        its <code class="code">CampaignHook</code> object.
                     </p>
                     
                     <p>In both cases, set the following <code class="code">CampaignHook</code> attributes:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p><code class="code">LambdaFunctionName</code> – The name or ARN of
                                 the Lambda function that Amazon Pinpoint invokes to send messages for
                                 the campaign.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p><code class="code">Mode</code> – Set to <code class="code">DELIVERY</code>. With
                                 this mode, Amazon Pinpoint uses the function to deliver the messages
                                 for a campaign, and it doesn't attempt to send the messages
                                 through the standard channels.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="limits.html">« Previous </a><a class="awstoc" accesskey="n" href="doc-history.html">Next »</a></div>
                     <div id="copyright-main-footer">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Event Data"><a class="pagetoc" href="#channels-custom-event-data">Event Data</a></li>
                        <li class="pagetoc" name="Creating a Lambda&#xA;                                Function"><a class="pagetoc" href="#channels-custom-lambda-create">Creating a Lambda
                              Function</a></li>
                        <li class="pagetoc" name="Assigning a Lambda&#xA;                                Function Policy"><a class="pagetoc" href="#segments-dynamic-lambda-trust-policy">Assigning a Lambda
                              Function Policy</a></li>
                        <li class="pagetoc" name="Assigning a Lambda Function to a&#xA;                                Campaign"><a class="pagetoc" href="#channels-custom-assign">Assigning a Lambda Function to a
                              Campaign</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using our site, you consent
            to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      <div id="footer">
         <div id="footer_short_fb" class="hide" title="Feedback"><a target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/channels-custom.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=channels-custom"><i class="awsdocs-footer-text fa fa-envelope-o"></i></a></div>
         <div id="footer_toggle" class="mediaobject">
            <div id="footer_toggle_img" class="awsdocs-footer-text fa fa-caret-down"></div>
            <div id="footer_toggle_img_collapse" class="hide awsdocs-footer-text fa fa-caret-right"></div>
         </div>
         <div id="footer-left"><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/terms">Terms of Use</a><span class="awsdocs-footer-text"> | </span><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/privacy">Privacy</a><span class="awsdocs-footer-text"> | </span><span class="awsdocs-footer-text">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></div>
         <div id="footer-right">
            <div id="feedback">
               <div id="forums"><a id="forum_link" target="_blank" href="http://forums.aws.amazon.com/forum.jspa?forumID=225" class="awsdocs-footer-text">Have a question? Try the Forums.</a></div>
               <div id="feedback-message" class="awsdocs-footer-text">Did this page help you?</div>
               <div id="feedback-yesno-buttons"><a class="awstoc btn btn-default" target="_blank" href="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/channels-custom.html">Yes</a><a class="awstoc btn btn-default" target="_blank" href="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/channels-custom.html">No</a></div>
               <div id="feedback-feedback-button"><a class="awstoc btn btn-default" target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/channels-custom.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=channels-custom">Feedback</a></div>
            </div>
         </div>
      </div>
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Pinpoint';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   </body>
</html>