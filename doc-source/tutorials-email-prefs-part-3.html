<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Step 3: Create IAM Policies and
         Roles - Amazon Pinpoint
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="home" href="#top" />
      <link rel="up" href="tutorials-email-prefs.html" title="Tutorial: Setting Up an Email Preference Management&#xA;            System" />
      <link rel="prev" href="tutorials-email-prefs-part-2.html" title="Step 2: Add or Configure Endpoints" />
      <link rel="next" href="tutorials-email-prefs-part-4.html" title="Step 4: Create the Lambda Function" />
      <meta name="description" content="The next step in implementing the email preference management solution is to configure a policy and a role in AWS Identity and Access Management (IAM). For this solution, you need to create a policy that provides access to certain resources that are related to Amazon Pinpoint. You then create a role and attach the policy to it. Later in this tutorial, you create an AWS Lambda function that uses this role to call certain operations in the Amazon Pinpoint API." />
      <meta name="keywords" content="Pinpoint,Amazon Pinpoint,Customer engagement,Segmentation,Campaigns,Metrics" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="Amazon Pinpoint" />
      <meta name="guide" content="Developer Guide" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <link rel="icon" type="image/ico" href="images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />
      <link rel="stylesheet" type="text/css" href="font/css/font-awesome.min.css" />
      <link rel="stylesheet" type="text/css" href="css/google-font.css" />
      <link id="code-style" rel="stylesheet" type="text/css" href="css/code/light.css" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />
      <link rel="stylesheet" type="text/css" href="css/colorbox.css" />
      <link rel="stylesheet" type="text/css" href="css/awsdocs.css?v=20181221" /><script type="text/javascript" src="js/highlight.pack.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/jquery-ui.min.js"></script><script type="text/javascript" src="js/jquery.colorbox.js"></script><script type="text/javascript" src="js/awsdocs.min.js?v=20181221"></script></head>
   <body id="top">
      <div xmlns:db="http://docbook.org/ns/docbook" id="aws-nav" class="aws-nav-header">
         <div class="aws-nav-header-left">
            <div class="aws-nav-logo">
               <!--aws_logo_105x39.png--><a href="http://aws.amazon.com"><img src="images/aws_logo_105x39.png" alt="Amazon Web Services" /></a></div>
         </div>
         <div id="aws-nav-header-right" class="aws-nav-header-right">
            <div class="aws-nav-cta-button-outer"><a id="aws-nav-cta-button" class="aws-nav-button" href="https://console.aws.amazon.com/console/home">Sign In to the Console</a></div>
            <div class="aws-nav-popover-trigger" data-dropdown="aws-nav-dropdown-lang"><select id="languageSelection" onchange="SelectLanguage()">
                  <option value="/de_de/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">Deutsch</option>
                  <option value="/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html" selected="selected">English</option>
                  <option value="/es_es/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">Español</option>
                  <option value="/fr_fr/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">Français</option>
                  <option value="/it_it/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">Italiano</option>
                  <option value="/ja_jp/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">日本語</option>
                  <option value="/ko_kr/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">한국어</option>
                  <option value="/pt_br/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">Português</option>
                  <option value="/zh_cn/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">中文 (简体)</option>
                  <option value="/zh_tw/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">中文 (繁體)</option></select></div><a class="btn btn-kindle-link" id="kindle-link-top" target="_blank" href="http://www.amazon.com/dp/B07JKHTQVP" title="Open Kindle"></a><a class="btn btn-pdf-link" id="pdf-link-top" href="pinpoint-dg.pdf#tutorials-email-prefs-part-3" target="_blank" title="Open PDF"></a><a class="btn btn-github-link" id="github-link-top" href="https://github.com/awsdocs/amazon-pinpoint-developer-guide/tree/master/doc-source/tutorials-email-prefs-part-3.md" target="_blank" title="Edit on GitHub"></a><div id="aws-nav-quicklinks-separator" class="aws-nav-quicklinks-separator">
               <div class="aws-nav-left"></div>
               <div class="aws-nav-right"></div>
            </div>
         </div>
      </div>
      <div id="content-container">
         <div id="left-column">
            <div id="left-col-header">
               <div xmlns:db="http://docbook.org/ns/docbook" id="left-col-top-content">
                  <div id="service-name">Amazon Pinpoint </div>
                  <div id="search"><i id="search-icon" class="fa fa-search fa-2x"></i></div>
                  <div id="guide-info">Developer Guide
                     <div id="content-button"><i id="toggle-contents" class="fa fa-bars"></i></div>
                  </div>
               </div>
               <form id="finegrainedSearch" method="get" onsubmit="return searchFormSubmit(this);" action="/search/doc-search.html">
                  <div id="search-form"><select id="search-select" name="searchPath">
                        <option value="all">Entire Site</option>
                        <option value="AWSMarketplace">AMIs from AWS Marketplace</option>
                        <option value="amis">AMIs from All Sources</option>
                        <option value="articles">Articles &amp; Tutorials</option>
                        <option value="products_and_info">AWS Product Information</option>
                        <option value="case_studies">Case Studies</option>
                        <option value="customerapps">Customer Apps</option>
                        <option value="documentation">Documentation</option>
                        <option value="documentation-product">Documentation - This Product</option>
                        <option value="documentation-guide" selected="selected">Documentation - This Guide</option>
                        <option value="datasets">Public Data Sets</option>
                        <option value="releasenotes">Release Notes</option>
                        <option value="solution_providers">Partners</option>
                        <option value="code">Sample Code &amp; Libraries</option></select><br /><input id="search-query" name="searchQuery" type="text" placeholder="Search" /><input id="search-button" src="images/search-button.png" alt="Go" type="image" /></div><input type="hidden" name="this_doc_product" id="this_doc_product" value="Amazon Pinpoint" /><input type="hidden" name="this_doc_guide" id="this_doc_guide" value="Developer Guide" /><input type="hidden" name="doc_locale" value="en_us" /></form>
            </div>
            <div id="toc"></div>
         </div>
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> » <a href="/pinpoint/index.html">Amazon Pinpoint</a> » <a href="index.html">Developer Guide</a> » <a href="tutorials.html">Tutorials</a> » <a href="tutorials-email-prefs.html">Tutorial: Setting Up an Email Preference Management
                                    System</a> » <span class="breadcrumb">Step 3: Create IAM Policies and
                                    Roles</span></div>
                           </td>
                        </tr>
                     </table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="tutorials-email-prefs-part-3">Step 3: Create IAM Policies and
                        Roles
                     </h1>
                     <p>The next step in implementing the email preference management solution is to configure
                        a
                        policy and a role in AWS Identity and Access Management (IAM). For this solution,
                        you need to create a policy that
                        provides access to certain resources that are related to Amazon Pinpoint. You then
                        create a role and
                        attach the policy to it. Later in this tutorial, you create an AWS Lambda function
                        that uses
                        this role to call certain operations in the Amazon Pinpoint API.
                     </p>
                     
                     <h2 id="tutorials-email-prefs-part-3-create-policy">Step 3.1: Create an IAM
                        Policy
                     </h2>
                     
                     <p>This section shows you how to create an IAM policy. Users and roles that use this
                        policy are able to view, create, and update Amazon Pinpoint endpoints.
                     </p>
                     
                     <p>In this tutorial, you want to give Lambda the ability to perform these tasks. However,
                        for added security, this policy uses the principal of granting <em>least
                           privilege</em>. In other words, it grants only the permissions that are
                        required to complete this solution, and no more. You can only use this policy to view,
                        create, or update endpoints that are associated with a specific Amazon Pinpoint project.
                     </p>
                     
                     <p class="title"><b>To create the policy</b></p>
                     <ol>
                        <li>
                           <p>Sign in to the AWS Management Console and open the IAM console at <a href="https://console.aws.amazon.com/iam/" target="_blank">https://console.aws.amazon.com/iam/</a>.
                           </p>
                        </li>
                        <li>
                           
                           <p>In the navigation pane, choose <b>Policies</b>, and then choose
                              <b>Create policy</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the <b>JSON</b> tab, paste the following code.
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="json ">{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "logs:CreateLogGroup"
            ],
            "Resource": "arn:aws:logs:*:*:*"
        },
        {
            "Effect": "Allow",
            "Action": [
                "mobiletargeting:UpdateEndpoint",
                "mobiletargeting:GetEndpoint"
            ],
            "Resource": "arn:aws:mobiletargeting:<em class="replaceable"><code>region</code></em>:<em class="replaceable"><code>accountId</code></em>:apps/<em class="replaceable"><code>projectId</code></em>/endpoints/*"
        }
    ]
}</code></pre>
                           <p>In the preceding example, do the following:</p>
                           
                           <div class="itemizedlist">
                              
                              
                              
                              
                              <ul class="itemizedlist" type="disc">
                                 <li class="listitem">
                                    
                                    <p>Replace <em class="replaceable"><code>region</code></em> with the AWS Region that
                                       you use Amazon Pinpoint in, such as <code class="code">us-east-1</code> or
                                       <code class="code">eu-central-1</code>.
                                    </p>
                                    
                                    <div class="aws-note">
                                       <p class="aws-note">Tip</p>
                                       <p>For a complete list of AWS Regions where Amazon Pinpoint is available, see
                                          <a href="https://docs.aws.amazon.com/general/latest/gr/rande.html#pinpoint_region">AWS Regions
                                             and Endpoints</a> in the
                                          <em>AWS General Reference</em>.
                                       </p>
                                    </div>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Replace <em class="replaceable"><code>accountId</code></em> with the unique ID for
                                       your AWS account.
                                    </p>
                                    
                                 </li>
                                 <li class="listitem">
                                    
                                    <p>Replace <em class="replaceable"><code>projectId</code></em> with the unique ID of the
                                       project that you created in <a href="tutorials-email-prefs-part-1.html#tutorials-email-prefs-part-1-create-project">Step
                                          1.1</a> of this tutorial.
                                    </p>
                                    
                                 </li>
                              </ul>
                           </div>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>The <code class="code">logs</code> actions enable Lambda to log its output in
                                 CloudWatch Logs.
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Review policy</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>For <b>Name</b>, enter a name for the policy, such as
                              <strong class="userinput"><code>EmailPreferencesPolicy</code></strong>. Choose <b>Create
                                 policy</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="tutorials-email-prefs-part-3-create-role">Step 3.2: Create an IAM
                        Role
                     </h2>
                     
                     <p>After you create the policy, you can create a role and attach the policy to it. The
                        Lambda function that you create in <a href="tutorials-email-prefs-part-3.html">Step
                           3</a> uses this role in order to gain access to the necessary AWS resources. 
                     </p>
                     
                     <p class="title"><b>To create the role</b></p>
                     <ol>
                        <li>
                           <p>Open the IAM console at
                              <a href="https://console.aws.amazon.com/iam/" target="_blank">https://console.aws.amazon.com/iam/</a>.
                           </p>
                        </li>
                        <li>
                           
                           <p>In the IAM console, in the navigation pane, choose
                              <b>Roles</b>, and then choose <b>Create
                                 role</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Choose the service that will use this role</b>, choose
                              <b>Lambda</b>, and then choose <b>Next:
                                 Permissions</b>.
                           </p>
                           
                           <div class="aws-note">
                              <p class="aws-note">Note</p>
                              <p>The service that you choose in this step isn't important—regardless
                                 of the service that you choose, you apply your own policy in the next
                                 step.
                              </p>
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Attach permissions policies</b>, choose the policy that
                              you created in the previous section, and then choose <b>Next:
                                 Tags</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Next: Review</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Review</b>, for <b>Name</b>, enter a name
                              for the role, such as <strong class="userinput"><code>EmailPreferencesForm</code></strong>. Choose
                              <b>Create role</b>.
                           </p>
                           
                        </li>
                     </ol>
                     
                     <p><b>Next</b>: <a href="tutorials-email-prefs-part-4.html">Create the Lambda Function</a></p>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="tutorials-email-prefs-part-2.html">« Previous </a><a class="awstoc" accesskey="n" href="tutorials-email-prefs-part-4.html">Next »</a></div>
                     <div id="copyright-main-footer">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Step 3.1: Create an IAM&#xA;                Policy"><a class="pagetoc" href="#tutorials-email-prefs-part-3-create-policy">Create an IAM
                              Policy</a></li>
                        <li class="pagetoc" name="Step 3.2: Create an IAM&#xA;                Role"><a class="pagetoc" href="#tutorials-email-prefs-part-3-create-role">Create an IAM
                              Role</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using our site, you consent
            to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      <div id="footer">
         <div id="footer_short_fb" class="hide" title="Feedback"><a target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=tutorials-email-prefs-part-3"><i class="awsdocs-footer-text fa fa-envelope-o"></i></a></div>
         <div id="footer_toggle" class="mediaobject">
            <div id="footer_toggle_img" class="awsdocs-footer-text fa fa-caret-down"></div>
            <div id="footer_toggle_img_collapse" class="hide awsdocs-footer-text fa fa-caret-right"></div>
         </div>
         <div id="footer-left"><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/terms">Terms of Use</a><span class="awsdocs-footer-text"> | </span><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/privacy">Privacy</a><span class="awsdocs-footer-text"> | </span><span class="awsdocs-footer-text">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></div>
         <div id="footer-right">
            <div id="feedback">
               <div id="forums"><a id="forum_link" target="_blank" href="http://forums.aws.amazon.com/forum.jspa?forumID=225" class="awsdocs-footer-text">Have a question? Try the Forums.</a></div>
               <div id="feedback-message" class="awsdocs-footer-text">Did this page help you?</div>
               <div id="feedback-yesno-buttons"><a class="awstoc btn btn-default" target="_blank" href="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">Yes</a><a class="awstoc btn btn-default" target="_blank" href="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html">No</a></div>
               <div id="feedback-feedback-button"><a class="awstoc btn btn-default" target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-3.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=tutorials-email-prefs-part-3">Feedback</a></div>
            </div>
         </div>
      </div>
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Pinpoint';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   </body>
</html>