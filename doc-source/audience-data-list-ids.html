<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Listing Endpoint IDs with Amazon Pinpoint - Amazon Pinpoint</title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="home" href="#top" />
      <link rel="up" href="audience-data.html" title="Accessing Audience Data in Amazon Pinpoint" />
      <link rel="prev" href="audience-data-export.html" title="Exporting Endpoints from Amazon Pinpoint" />
      <link rel="next" href="segments.html" title="Creating Segments" />
      <meta name="description" content="Get a list of your endpoint IDs if you need to update or delete all of the endpoints in your Amazon Pinpoint project." />
      <meta name="keywords" content="Pinpoint,Amazon Pinpoint,Customer engagement,Segmentation,Campaigns,Metrics" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="Amazon Pinpoint" />
      <meta name="guide" content="Developer Guide" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <link rel="icon" type="image/ico" href="images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/pinpoint/latest/developerguide/audience-data-list-ids.html" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />
      <link rel="stylesheet" type="text/css" href="font/css/font-awesome.min.css" />
      <link rel="stylesheet" type="text/css" href="css/google-font.css" />
      <link id="code-style" rel="stylesheet" type="text/css" href="css/code/light.css" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />
      <link rel="stylesheet" type="text/css" href="css/colorbox.css" />
      <link rel="stylesheet" type="text/css" href="css/awsdocs.css?v=20181221" /><script type="text/javascript" src="js/highlight.pack.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/jquery-ui.min.js"></script><script type="text/javascript" src="js/jquery.colorbox.js"></script><script type="text/javascript" src="js/awsdocs.min.js?v=20181221"></script></head>
   <body id="top">
      <div xmlns:db="http://docbook.org/ns/docbook" id="aws-nav" class="aws-nav-header">
         <div class="aws-nav-header-left">
            <div class="aws-nav-logo">
               <!--aws_logo_105x39.png--><a href="http://aws.amazon.com"><img src="images/aws_logo_105x39.png" alt="Amazon Web Services" /></a></div>
         </div>
         <div id="aws-nav-header-right" class="aws-nav-header-right">
            <div class="aws-nav-cta-button-outer"><a id="aws-nav-cta-button" class="aws-nav-button" href="https://console.aws.amazon.com/console/home">Sign In to the Console</a></div>
            <div class="aws-nav-popover-trigger" data-dropdown="aws-nav-dropdown-lang"><select id="languageSelection" onchange="SelectLanguage()">
                  <option value="/de_de/pinpoint/latest/developerguide/audience-data-list-ids.html">Deutsch</option>
                  <option value="/en_us/pinpoint/latest/developerguide/audience-data-list-ids.html" selected="selected">English</option>
                  <option value="/es_es/pinpoint/latest/developerguide/audience-data-list-ids.html">Español</option>
                  <option value="/fr_fr/pinpoint/latest/developerguide/audience-data-list-ids.html">Français</option>
                  <option value="/it_it/pinpoint/latest/developerguide/audience-data-list-ids.html">Italiano</option>
                  <option value="/ja_jp/pinpoint/latest/developerguide/audience-data-list-ids.html">日本語</option>
                  <option value="/ko_kr/pinpoint/latest/developerguide/audience-data-list-ids.html">한국어</option>
                  <option value="/pt_br/pinpoint/latest/developerguide/audience-data-list-ids.html">Português</option>
                  <option value="/zh_cn/pinpoint/latest/developerguide/audience-data-list-ids.html">中文 (简体)</option>
                  <option value="/zh_tw/pinpoint/latest/developerguide/audience-data-list-ids.html">中文 (繁體)</option></select></div><a class="btn btn-kindle-link" id="kindle-link-top" target="_blank" href="http://www.amazon.com/dp/B07JKHTQVP" title="Open Kindle"></a><a class="btn btn-pdf-link" id="pdf-link-top" href="pinpoint-dg.pdf#audience-data-list-ids" target="_blank" title="Open PDF"></a><a class="btn btn-github-link" id="github-link-top" href="https://github.com/awsdocs/amazon-pinpoint-developer-guide/tree/master/doc-source/audience-data-list-ids.md" target="_blank" title="Edit on GitHub"></a><div id="aws-nav-quicklinks-separator" class="aws-nav-quicklinks-separator">
               <div class="aws-nav-left"></div>
               <div class="aws-nav-right"></div>
            </div>
         </div>
      </div>
      <div id="content-container">
         <div id="left-column">
            <div id="left-col-header">
               <div xmlns:db="http://docbook.org/ns/docbook" id="left-col-top-content">
                  <div id="service-name">Amazon Pinpoint </div>
                  <div id="search"><i id="search-icon" class="fa fa-search fa-2x"></i></div>
                  <div id="guide-info">Developer Guide
                     <div id="content-button"><i id="toggle-contents" class="fa fa-bars"></i></div>
                  </div>
               </div>
               <form id="finegrainedSearch" method="get" onsubmit="return searchFormSubmit(this);" action="/search/doc-search.html">
                  <div id="search-form"><select id="search-select" name="searchPath">
                        <option value="all">Entire Site</option>
                        <option value="AWSMarketplace">AMIs from AWS Marketplace</option>
                        <option value="amis">AMIs from All Sources</option>
                        <option value="articles">Articles &amp; Tutorials</option>
                        <option value="products_and_info">AWS Product Information</option>
                        <option value="case_studies">Case Studies</option>
                        <option value="customerapps">Customer Apps</option>
                        <option value="documentation">Documentation</option>
                        <option value="documentation-product">Documentation - This Product</option>
                        <option value="documentation-guide" selected="selected">Documentation - This Guide</option>
                        <option value="datasets">Public Data Sets</option>
                        <option value="releasenotes">Release Notes</option>
                        <option value="solution_providers">Partners</option>
                        <option value="code">Sample Code &amp; Libraries</option></select><br /><input id="search-query" name="searchQuery" type="text" placeholder="Search" /><input id="search-button" src="images/search-button.png" alt="Go" type="image" /></div><input type="hidden" name="this_doc_product" id="this_doc_product" value="Amazon Pinpoint" /><input type="hidden" name="this_doc_guide" id="this_doc_guide" value="Developer Guide" /><input type="hidden" name="doc_locale" value="en_us" /></form>
            </div>
            <div id="toc"></div>
         </div>
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> » <a href="/pinpoint/index.html">Amazon Pinpoint</a> » <a href="index.html">Developer Guide</a> » <a href="audience-data.html">Accessing Audience Data in Amazon Pinpoint</a> » <span class="breadcrumb">Listing Endpoint IDs with Amazon Pinpoint</span></div>
                           </td>
                        </tr>
                     </table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="audience-data-list-ids">Listing Endpoint IDs with Amazon Pinpoint</h1>
                     <p>To update or delete an endpoint, you need the endpoint ID. So, if you want to perform
                        these operations on all of the endpoints in an Amazon Pinpoint project, the first
                        step is to list
                        all of the endpoint IDs that belong to that project. Then, you can iterate over these
                        IDs
                        to, for example, add an attribute globally or delete all of the endpoints in your
                        project.
                     </p>
                     <p>The following example uses the AWS SDK for Java and does the following:</p>
                     <div class="orderedlist">
                        
                        
                        
                        
                        
                        
                        <ol>
                           <li>
                              
                              <p>Calls the example <code class="code">exportEndpointsToS3</code> method from the example code in
                                 <a href="audience-data-export.html">Exporting Endpoints from Amazon Pinpoint</a>.
                                 This method exports the endpoint definitions from an Amazon Pinpoint project. The
                                 endpoint
                                 definitions are added as gzip files to an Amazon S3 bucket.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>Downloads the exported gzip files.</p>
                              
                           </li>
                           <li>
                              
                              <p>Reads the gzip files and obtains the endpoint ID from each endpoint's JSON
                                 definition.
                              </p>
                              
                           </li>
                           <li>
                              
                              <p>Prints the endpoint IDs to the console.</p>
                              
                           </li>
                           <li>
                              
                              <p>Cleans up by deleting the files that Amazon Pinpoint added to Amazon S3.</p>
                              
                           </li>
                        </ol>
                     </div><pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="java ">
import com.amazonaws.AmazonServiceException;
import com.amazonaws.services.s3.AmazonS3;
import com.amazonaws.services.s3.AmazonS3ClientBuilder;
import com.amazonaws.services.s3.model.DeleteObjectsRequest;
import com.amazonaws.services.s3.model.S3Object;
import com.google.gson.FieldNamingPolicy;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonObject;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.List;
import java.util.stream.Collectors;
import java.util.zip.GZIPInputStream;

public class ListEndpointIds {

    public static void main(String[] args) {

        final String USAGE = "\n" +
                "ListEndpointIds - Prints all of the endpoint IDs that belong to an Amazon " +
                "Pinpoint application. This program performs the following steps:\n\n" +

                "1) Exports the endpoints to an Amazon S3 bucket.\n" +
                "2) Downloads the exported endpoints files from Amazon S3.\n" +
                "3) Parses the endpoints files to obtain the endpoint IDs and prints them.\n" +
                "4) Cleans up by deleting the objects that Amazon Pinpoint created in the S3 " +
                "bucket.\n\n" +

                "Usage: ListEndpointIds &lt;applicationId&gt; &lt;s3BucketName&gt; &lt;iamExportRoleArn&gt;\n\n" +

                "Where:\n" +
                "  applicationId - The ID of the Amazon Pinpoint application that has the " +
                "endpoint.\n" +
                "  s3BucketName - The name of the Amazon S3 bucket to export the JSON file to. If" +
                " the bucket doesn't exist, a new bucket is created.\n" +
                "  iamExportRoleArn - The ARN of an IAM role that grants Amazon Pinpoint write " +
                "permissions to the S3 bucket.";

        if (args.length &lt; 1) {
            System.out.println(USAGE);
            System.exit(1);
        }

        String applicationId = args[0];
        String s3BucketName = args[1];
        String iamExportRoleArn = args[2];

        // Exports the endpoints to Amazon S3 and stores the keys of the new objects.
        List&lt;String&gt; objectKeys =
                ExportEndpoints.exportEndpointsToS3(s3BucketName, iamExportRoleArn, applicationId);

        // Filters the keys to only those objects that have the endpoint definitions.
        // These objects have the .gz extension.
        List&lt;String&gt; endpointFileKeys = objectKeys
                .stream()
                .filter(o -&gt; o.endsWith(".gz"))
                .collect(Collectors.toList());

        // Gets the endpoint IDs from the exported endpoints files.
        List&lt;String&gt; endpointIds = getEndpointIds(s3BucketName, endpointFileKeys);

        System.out.println("Endpoint IDs:");

        for (String endpointId : endpointIds) {
            System.out.println("\t- " + endpointId);
        }

        // Deletes the objects that Amazon Pinpoint created in the S3 bucket.
        deleteS3Objects(s3BucketName, objectKeys);
    }

    private static List&lt;String&gt; getEndpointIds(String s3bucketName, List&lt;String&gt; endpointFileKeys) {

        List&lt;String&gt; endpointIds = new ArrayList&lt;&gt;();

        // Initializes the Amazon S3 client.
        AmazonS3 s3Client = AmazonS3ClientBuilder.defaultClient();

        // Gets the endpoint IDs from the exported endpoints files.
        try {
            for (String key : endpointFileKeys) {
                S3Object endpointFile = s3Client.getObject(s3bucketName, key);
                endpointIds.addAll(getEndpointIdsFromFile(endpointFile));
            }
        } catch (AmazonServiceException e) {
            System.err.println(e.getMessage());
            System.exit(1);
        }

        return endpointIds;
    }

    private static List&lt;String&gt; getEndpointIdsFromFile(S3Object endpointsFile) {

        List&lt;String&gt; endpointIdsFromFile = new ArrayList&lt;&gt;();

        // The Google Gson library is used to parse the exported endpoint JSON.
        Gson gson = new GsonBuilder()
                .setFieldNamingPolicy(FieldNamingPolicy.UPPER_CAMEL_CASE)
                .create();

        // Reads each endpoint entry in the file and adds the ID to the list.
        try (GZIPInputStream gzipInputStream =
                     new GZIPInputStream(endpointsFile.getObjectContent());
             BufferedReader reader =
                     new BufferedReader(new InputStreamReader(
                             gzipInputStream, "UTF-8"))) {
            String endpointString;
            while ((endpointString = reader.readLine()) != null) {
                JsonObject endpointJson = gson.fromJson(endpointString, JsonObject.class);
                endpointIdsFromFile.add(endpointJson
                        .getAsJsonPrimitive("Id")
                        .getAsString());
            }
        } catch (IOException e) {
            System.err.println(e.getMessage());
            System.exit(1);
        }

        return endpointIdsFromFile;
    }

    private static void deleteS3Objects(String s3BucketName, List&lt;String&gt; keys) {

        AmazonS3 s3Client = AmazonS3ClientBuilder.defaultClient();

        String[] keysArray = keys.toArray(new String[keys.size()]);
        DeleteObjectsRequest request = new DeleteObjectsRequest(s3BucketName).withKeys(keysArray);

        System.out.println("Deleting the following Amazon S3 objects created by Amazon Pinpoint:");

        for (String key : keys) {
            System.out.println("\t- " + key);
        }

        try {
            s3Client.deleteObjects(request);
        } catch (AmazonServiceException e) {
            System.err.println(e.getErrorMessage());
            System.exit(1);
        }

        System.out.println("Finished deleting objects.");
    }
}

</code></pre></div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="audience-data-export.html">« Previous </a><a class="awstoc" accesskey="n" href="segments.html">Next »</a></div>
                     <div id="copyright-main-footer">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper"></div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using our site, you consent
            to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      <div id="footer">
         <div id="footer_short_fb" class="hide" title="Feedback"><a target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/audience-data-list-ids.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=audience-data-list-ids"><i class="awsdocs-footer-text fa fa-envelope-o"></i></a></div>
         <div id="footer_toggle" class="mediaobject">
            <div id="footer_toggle_img" class="awsdocs-footer-text fa fa-caret-down"></div>
            <div id="footer_toggle_img_collapse" class="hide awsdocs-footer-text fa fa-caret-right"></div>
         </div>
         <div id="footer-left"><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/terms">Terms of Use</a><span class="awsdocs-footer-text"> | </span><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/privacy">Privacy</a><span class="awsdocs-footer-text"> | </span><span class="awsdocs-footer-text">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></div>
         <div id="footer-right">
            <div id="feedback">
               <div id="forums"><a id="forum_link" target="_blank" href="http://forums.aws.amazon.com/forum.jspa?forumID=225" class="awsdocs-footer-text">Have a question? Try the Forums.</a></div>
               <div id="feedback-message" class="awsdocs-footer-text">Did this page help you?</div>
               <div id="feedback-yesno-buttons"><a class="awstoc btn btn-default" target="_blank" href="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/audience-data-list-ids.html">Yes</a><a class="awstoc btn btn-default" target="_blank" href="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/audience-data-list-ids.html">No</a></div>
               <div id="feedback-feedback-button"><a class="awstoc btn btn-default" target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/audience-data-list-ids.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=audience-data-list-ids">Feedback</a></div>
            </div>
         </div>
      </div>
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Pinpoint';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   </body>
</html>