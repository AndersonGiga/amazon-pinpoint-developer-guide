<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Step 6: Create and Deploy the Web
         Form - Amazon Pinpoint
      </title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link rel="home" href="#top" />
      <link rel="up" href="tutorials-email-prefs.html" title="Tutorial: Setting Up an Email Preference Management&#xA;            System" />
      <link rel="prev" href="tutorials-email-prefs-part-5.html" title="Step 5: Set Up Amazon API Gateway" />
      <link rel="next" href="tutorials-email-prefs-part-7.html" title="Step 7: Create and Send Amazon Pinpoint&#xA;            Campaigns" />
      <meta name="description" content="All of the components of this solution that use AWS services are now in place. The last step is to create and deploy the web form that captures customer's data." />
      <meta name="keywords" content="Pinpoint,Amazon Pinpoint,Customer engagement,Segmentation,Campaigns,Metrics" />
      <meta name="deployment_region" content="IAD" />
      <meta name="product" content="Amazon Pinpoint" />
      <meta name="guide" content="Developer Guide" />
      <meta name="guide-locale" content="en_us" />
      <meta name="tocs" content="toc-contents.json" />
      <link rel="icon" type="image/ico" href="images/favicon.ico" />
      <link rel="shortcut icon" type="image/ico" href="images/favicon.ico" />
      <link rel="canonical" href="https://docs.aws.amazon.com/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css" />
      <link rel="stylesheet" type="text/css" href="font/css/font-awesome.min.css" />
      <link rel="stylesheet" type="text/css" href="css/google-font.css" />
      <link id="code-style" rel="stylesheet" type="text/css" href="css/code/light.css" />
      <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.css" />
      <link rel="stylesheet" type="text/css" href="css/colorbox.css" />
      <link rel="stylesheet" type="text/css" href="css/awsdocs.css?v=20181221" /><script type="text/javascript" src="js/highlight.pack.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/jquery-ui.min.js"></script><script type="text/javascript" src="js/jquery.colorbox.js"></script><script type="text/javascript" src="js/awsdocs.min.js?v=20181221"></script></head>
   <body id="top">
      <div xmlns:db="http://docbook.org/ns/docbook" id="aws-nav" class="aws-nav-header">
         <div class="aws-nav-header-left">
            <div class="aws-nav-logo">
               <!--aws_logo_105x39.png--><a href="http://aws.amazon.com"><img src="images/aws_logo_105x39.png" alt="Amazon Web Services" /></a></div>
         </div>
         <div id="aws-nav-header-right" class="aws-nav-header-right">
            <div class="aws-nav-cta-button-outer"><a id="aws-nav-cta-button" class="aws-nav-button" href="https://console.aws.amazon.com/console/home">Sign In to the Console</a></div>
            <div class="aws-nav-popover-trigger" data-dropdown="aws-nav-dropdown-lang"><select id="languageSelection" onchange="SelectLanguage()">
                  <option value="/de_de/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">Deutsch</option>
                  <option value="/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html" selected="selected">English</option>
                  <option value="/es_es/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">Español</option>
                  <option value="/fr_fr/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">Français</option>
                  <option value="/it_it/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">Italiano</option>
                  <option value="/ja_jp/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">日本語</option>
                  <option value="/ko_kr/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">한국어</option>
                  <option value="/pt_br/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">Português</option>
                  <option value="/zh_cn/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">中文 (简体)</option>
                  <option value="/zh_tw/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">中文 (繁體)</option></select></div><a class="btn btn-kindle-link" id="kindle-link-top" target="_blank" href="http://www.amazon.com/dp/B07JKHTQVP" title="Open Kindle"></a><a class="btn btn-pdf-link" id="pdf-link-top" href="pinpoint-dg.pdf#tutorials-email-prefs-part-6" target="_blank" title="Open PDF"></a><a class="btn btn-github-link" id="github-link-top" href="https://github.com/awsdocs/amazon-pinpoint-developer-guide/tree/master/doc-source/tutorials-email-prefs-part-6.md" target="_blank" title="Edit on GitHub"></a><div id="aws-nav-quicklinks-separator" class="aws-nav-quicklinks-separator">
               <div class="aws-nav-left"></div>
               <div class="aws-nav-right"></div>
            </div>
         </div>
      </div>
      <div id="content-container">
         <div id="left-column">
            <div id="left-col-header">
               <div xmlns:db="http://docbook.org/ns/docbook" id="left-col-top-content">
                  <div id="service-name">Amazon Pinpoint </div>
                  <div id="search"><i id="search-icon" class="fa fa-search fa-2x"></i></div>
                  <div id="guide-info">Developer Guide
                     <div id="content-button"><i id="toggle-contents" class="fa fa-bars"></i></div>
                  </div>
               </div>
               <form id="finegrainedSearch" method="get" onsubmit="return searchFormSubmit(this);" action="/search/doc-search.html">
                  <div id="search-form"><select id="search-select" name="searchPath">
                        <option value="all">Entire Site</option>
                        <option value="AWSMarketplace">AMIs from AWS Marketplace</option>
                        <option value="amis">AMIs from All Sources</option>
                        <option value="articles">Articles &amp; Tutorials</option>
                        <option value="products_and_info">AWS Product Information</option>
                        <option value="case_studies">Case Studies</option>
                        <option value="customerapps">Customer Apps</option>
                        <option value="documentation">Documentation</option>
                        <option value="documentation-product">Documentation - This Product</option>
                        <option value="documentation-guide" selected="selected">Documentation - This Guide</option>
                        <option value="datasets">Public Data Sets</option>
                        <option value="releasenotes">Release Notes</option>
                        <option value="solution_providers">Partners</option>
                        <option value="code">Sample Code &amp; Libraries</option></select><br /><input id="search-query" name="searchQuery" type="text" placeholder="Search" /><input id="search-button" src="images/search-button.png" alt="Go" type="image" /></div><input type="hidden" name="this_doc_product" id="this_doc_product" value="Amazon Pinpoint" /><input type="hidden" name="this_doc_guide" id="this_doc_guide" value="Developer Guide" /><input type="hidden" name="doc_locale" value="en_us" /></form>
            </div>
            <div id="toc"></div>
         </div>
         <div id="main-column">
            <div id="main">
               <div id="main-content">
                  <div id="main-col-body">
                     <table summary="Breadcrumbs">
                        <tr>
                           <td>
                              <div class="breadcrumb"><a href="/index.html">AWS Documentation</a> » <a href="/pinpoint/index.html">Amazon Pinpoint</a> » <a href="index.html">Developer Guide</a> » <a href="tutorials.html">Tutorials</a> » <a href="tutorials-email-prefs.html">Tutorial: Setting Up an Email Preference Management
                                    System</a> » <span class="breadcrumb">Step 6: Create and Deploy the Web
                                    Form</span></div>
                           </td>
                        </tr>
                     </table>
                     <div id="language-notice">
                        <div class="language-notice-text"></div>
                     </div>
                     <div></div>
                     <h1 class="topictitle" id="tutorials-email-prefs-part-6">Step 6: Create and Deploy the Web
                        Form
                     </h1>
                     <p>All of the components of this solution that use AWS services are now in place. The
                        last
                        step is to create and deploy the web form that captures customer's data.
                     </p>
                     
                     <h2 id="tutorials-email-prefs-part-6-create-form-handler">Step 6.1: Create the
                        JavaScript Form Handler
                     </h2>
                     
                     <p>In this section, you create a JavaScript function that parses the content of the web
                        form that you create in the next section. After parsing the content, this function
                        sends
                        the data to the API that you created in <a href="tutorials-email-prefs-part-4.html">Part 4</a>.
                     </p>
                     
                     <p class="title"><b>To create the form handler</b></p>
                     <ol>
                        <li>
                           
                           <p>In a text editor, create a new file.</p>
                           
                        </li>
                        <li>
                           
                           <p>In the editor, paste the following code.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="js ">$(document).ready(function() {

  // Function that parses URL parameters.
  function getParameterByName(name) {
    name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\?&amp;]" + name + "=([^&amp;#]*)"),
      results = regex.exec(location.search);
    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }

  // Pre-fill form data.
  $("#firstName").val(getParameterByName("firstName"));
  $("#lastName").val(getParameterByName("lastName"));
  $("#email").val(getParameterByName("email"));
  $("#endpointId").val(getParameterByName("endpointId"));
  if (getParameterByName("t1") == "OptIn") {
    $("#topic1In").prop('checked', true);
  }
  if (getParameterByName("t2") == "OptIn") {
    $("#topic2In").prop('checked', true);
  }
  if (getParameterByName("t3") == "OptIn") {
    $("#topic3In").prop('checked', true);
  }
  if (getParameterByName("t4") == "OptIn") {
    $("#topic4In").prop('checked', true);
  }

  // Handle form submission.
  $("#submit").click(function(e) {

    // Get endpoint ID from URL parameter.
    var endpointId = getParameterByName("endpointId");

    var firstName = $("#firstName").val(),
      lastName = $("#lastName").val(),
      email = $("#email").val(),
      source = window.location.pathname,
      optTimestamp = undefined,
      utcSeconds = Date.now() / 1000,
      timestamp = new Date(0);

    var topicOptIn = [
      $('#topic1In').is(':checked'),
      $('#topic2In').is(':checked'),
      $('#topic3In').is(':checked'),
      $('#topic4In').is(':checked')
    ];

    e.preventDefault();

    $('#submit').prop('disabled', true);
    $('#submit').html('&lt;span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"&gt;&lt;/span&gt;  Saving your preferences&lt;/button&gt;');

    // If customer unchecks a box, or leaves a box unchecked, set the opt
    // status to "OptOut".
    for (i = 0; i &lt; topicOptIn.length; i++) {
      if (topicOptIn[i] == true) {
        topicOptIn[i] = "OptIn";
      } else {
        topicOptIn[i] = "OptOut";
      }
    }

    timestamp.setUTCSeconds(utcSeconds);

    var data = JSON.stringify({
      'endpointId': endpointId,
      'firstName': firstName,
      'lastName': lastName,
      'topic1': topicOptIn[0],
      'topic2': topicOptIn[1],
      'topic3': topicOptIn[2],
      'topic4': topicOptIn[3],
      'source': source,
      'optTimestamp': timestamp.toString(),
      'optOutAll': false
    });

    $.ajax({
      type: 'POST',
      url: 'https://example.execute-api.us-east-1.amazonaws.com/v1/prefs',
      contentType: 'application/json',
      data: data,
      success: function(res) {
        $('#form-response').html('&lt;div class="mt-3 alert alert-success" role="alert"&gt;Your preferences have been saved!&lt;/div&gt;');
        $('#submit').prop('hidden', true);
        $('#unsubAll').prop('hidden', true);
        $('#submit').text('Preferences saved!');
      },
      error: function(jqxhr, status, exception) {
        $('#form-response').html('&lt;div class="mt-3 alert alert-danger" role="alert"&gt;An error occurred. Please try again later.&lt;/div&gt;');
        $('#submit').text('Save preferences');
        $('#submit').prop('disabled', false);
      }
    });
  });

  // Handle the case when the customer clicks the "Unsubscribe from all"
  // button.
  $("#unsubAll").click(function(e) {
    var firstName = $("#firstName").val(),
      lastName = $("#lastName").val(),
      source = window.location.pathname,
      optTimestamp = undefined,
      utcSeconds = Date.now() / 1000,
      timestamp = new Date(0);

    // Get endpoint ID from URL parameter.
    var endpointId = getParameterByName("endpointId");

    e.preventDefault();

    $('#unsubAll').prop('disabled', true);
    $('#unsubAll').html('&lt;span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"&gt;&lt;/span&gt;  Saving your preferences&lt;/button&gt;');

    // Uncheck all boxes to give user a visual representation of the opt-out action.
    $("#topic1In").prop('checked', false);
    $("#topic2In").prop('checked', false);
    $("#topic3In").prop('checked', false);
    $("#topic4In").prop('checked', false);

    timestamp.setUTCSeconds(utcSeconds);

    var data = JSON.stringify({
      'endpointId': endpointId,
      'source': source,
      'optTimestamp': timestamp.toString(),
      'optOutAll': true
    });

    $.ajax({
      type: 'POST',
      url: 'https://example.execute-api.us-east-1.amazonaws.com/v1/prefs',
      contentType: 'application/json',
      data: data,
      success: function(res) {
        $('#form-response').html('&lt;div class="mt-3 alert alert-info" role="alert"&gt;Successfully opted you out of all future email communications.&lt;/div&gt;');
        $('#submit').prop('hidden', true);
        $('#unsubAll').prop('hidden', true);
      },
      error: function(jqxhr, status, exception) {
        $('#form-response').html('&lt;div class="mt-3 alert alert-danger" role="alert"&gt;An error occurred. Please try again later.&lt;/div&gt;');
      }
    });
  });
});
</code></pre>
                           </li>
                        <li>
                           
                           <p>In the preceding example, replace
                              <em class="replaceable"><code>https://example.execute-api.us-east-1.amazonaws.com/v1/prefs</code></em>
                              with the <b>Invoke URL</b> that you obtained in <a href="tutorials-email-prefs-part-5.html#tutorials-email-prefs-part-5-deploy-api">Step 5.3</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Save the file.</p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="tutorials-email-prefs-part-6-create-form">Step 6.2: Create the Form
                        File
                     </h2>
                     
                     <p>In this section, you create an HTML file that contains the form that customers use
                        to
                        manage their email preferences. This file uses the JavaScript form handler that you
                        created in the previous section to transmit the form data to your Lambda function.
                     </p>
                     
                     <div class="aws-note">
                        <p class="aws-note">Important</p>
                        <p>When a user submits this form, it triggers a Lambda function that updates endpoints
                           in your Amazon Pinpoint project. Malicious users could launch an attack on your form
                           that
                           could impact your data or cause a large number of requests to be made. If you plan
                           to use this solution for a production use case, you should secure it by using a
                           system such as <a href="https://www.google.com/recaptcha/intro/v3.html" target="_blank">Google
                              reCAPTCHA</a>.
                        </p>
                     </div>
                     
                     <p class="title"><b>To create the form</b></p>
                     <ol>
                        <li>
                           
                           <p>In a text editor, create a new file.</p>
                           
                        </li>
                        <li>
                           
                           <p>In the editor, paste the following code.</p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="html ">&lt;!doctype html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
  &lt;!-- Required meta tags --&gt;
  &lt;meta charset="utf-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"&gt;
  &lt;!-- Bootstrap CSS --&gt;
  &lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"&gt;
  &lt;!-- Bootstrap and AJAX scripts --&gt;
  &lt;script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"&gt;&lt;/script&gt;
  &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"&gt;&lt;/script&gt;
  &lt;script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"&gt;&lt;/script&gt;
  &lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"&gt;&lt;/script&gt;

  &lt;!-- Reference to JavaScript form handler. --&gt;
  &lt;script type="text/javascript" src="<em class="replaceable"><code>formHandler.js</code></em>"&gt;&lt;/script&gt;

  &lt;title&gt;Manage your email preferences&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;h1&gt;Manage your email subscriptions&lt;/h1&gt;
    &lt;h2 class="mt-3"&gt;Contact information&lt;/h2&gt;
    &lt;form&gt;

      &lt;div class="form-row mt-3"&gt;
        &lt;div class="form-group col-md-6"&gt;
          &lt;label for="email" class="font-weight-bold"&gt;Email address&lt;/label&gt;
          &lt;input type="email" class="form-control-plaintext" id="email" readonly&gt;
        &lt;/div&gt;
        &lt;div class="form-group col-md-6"&gt;
          &lt;label for="email" class="font-weight-bold"&gt;ID&lt;/label&gt;
          &lt;input type="email" class="form-control-plaintext" id="endpointId" readonly&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="form-row"&gt;
        &lt;div class="form-group col-md-6"&gt;
          &lt;label for="firstName" class="font-weight-bold"&gt;First name&lt;/label&gt;
          &lt;input type="text" class="form-control" id="firstName"&gt;
        &lt;/div&gt;
        &lt;div class="form-group col-md-6"&gt;
          &lt;label for="lastName" class="font-weight-bold"&gt;Last name&lt;/label&gt;
          &lt;input type="text" class="form-control" id="lastName"&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class="form-row"&gt;
        &lt;div class="col-md-12"&gt;
          &lt;p class="font-weight-bold mt-3"&gt;Subscriptions&lt;/p&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- Change topic names here, if necessary --&gt;
      &lt;div class="form-row"&gt;
        &lt;div class="col-md-6"&gt;
          &lt;div class="custom-control custom-switch"&gt;
            &lt;input type="checkbox" class="custom-control-input" id="topic1In"&gt;
            &lt;label class="custom-control-label font-weight-bold" for="topic1In"&gt;Special offers&lt;/label&gt;
            &lt;p&gt;Get exclusive offers available only to subscribers.&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="col-md-6"&gt;
          &lt;div class="custom-control custom-switch"&gt;
            &lt;input type="checkbox" class="custom-control-input" id="topic2In"&gt;
            &lt;label class="custom-control-label font-weight-bold" for="topic2In"&gt;Coming soon&lt;/label&gt;
            &lt;p&gt;Learn about our newest products before anyone else!&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class="form-row mt-3"&gt;
        &lt;div class="col-md-6"&gt;
          &lt;div class="custom-control custom-switch"&gt;
            &lt;input type="checkbox" class="custom-control-input" id="topic3In"&gt;
            &lt;label class="custom-control-label font-weight-bold" for="topic3In"&gt;New products&lt;/label&gt;
            &lt;p&gt;Get the inside scoop on products that haven't been released yet.&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="col-md-6"&gt;
          &lt;div class="custom-control custom-switch"&gt;
            &lt;input type="checkbox" class="custom-control-input" id="topic4In"&gt;
            &lt;label class="custom-control-label font-weight-bold" for="topic4In"&gt;Deal of the Day&lt;/label&gt;
            &lt;p&gt;Get special deals in your inbox every day!&lt;/p&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div id="form-response"&gt;&lt;/div&gt;

      &lt;div class="row mt-3"&gt;
        &lt;div class="col-md-12 text-center"&gt;
          &lt;button type="submit" id="submit" class="btn btn-primary"&gt;Update preferences&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;div class="row mt-3"&gt;
        &lt;div class="col-md-12 text-center"&gt;
          &lt;button type="button" class="btn btn-link" id="unsubAll"&gt;Unsubscribe from all email communications&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/form&gt;

    &lt;div class="row mt-3"&gt;
      &lt;div class="col-md-12 text-center"&gt;
        &lt;small class="text-muted"&gt;Copyright © 2019, ExampleCorp or its affiliates.&lt;/small&gt;
      &lt;/div&gt;
    &lt;/div&gt;

  &lt;/div&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
                           </li>
                        <li>
                           
                           <p>In the preceding example, replace <em class="replaceable"><code>formHandler.js</code></em>
                              with the full path to the form handler JavaScript file that you created in the
                              previous section.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Save the file.</p>
                           
                        </li>
                     </ol>
                     
                     
                     <h2 id="tutorials-email-prefs-part-6-upload-form">Step 6.3: Upload the Form
                        Files
                     </h2>
                     
                     <p>Now that you've created the HTML form and the JavaScript form handler, the last step
                        is to publish these files to the internet. This section assumes that you have an
                        existing web hosting provider. If you don't have an existing hosting provider, you
                        can
                        launch a website by using Amazon Route 53, Amazon Simple Storage Service (Amazon S3),
                        and Amazon CloudFront. For more
                        information, see <a href="https://aws.amazon.com/getting-started/projects/host-static-website/" target="_blank">Host a Static
                           Website</a>.
                     </p>
                     
                     <p>If you use another web hosting provider, consult the provider's documentation for
                        more
                        information about publishing webpages.
                     </p>
                     
                     
                     <h2 id="tutorials-email-prefs-part-6-test-form">Step 6.4: Test the Form</h2>
                     
                     <p>After you publish the form, you should test it to confirm that it works
                        properly.
                     </p>
                     
                     
                     <h3 id="tutorials-email-prefs-part-6-test-form-data">Step 6.4.1: Use the
                        Form to Submit Test Data
                     </h3>
                     
                     <p>The first step in testing the preferences form is to use it to submit some test
                        data. In this case, you opt in to all of the subscription topics that are listed on
                        the form.
                     </p>
                     
                     <p class="title"><b>To submit test data</b></p>
                     <ol>
                        <li>
                           
                           <p>In a web browser, go to the location where you uploaded the preferences
                              page. If you used the code example from <a href="tutorials-email-prefs-part-6.html#tutorials-email-prefs-part-6-create-form">Step 6.2</a>, you
                              see a form that resembles the example in the following image.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="images/Email_Prefs_Tutorial_Test_Step6.3.1_1.png" />
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>Add the following string to the end of the URL. Replace the values for
                              <em class="replaceable"><code>firstName</code></em>,
                              <em class="replaceable"><code>lastName</code></em>, and
                              <em class="replaceable"><code>endpointId</code></em> with the values that you specified
                              in Step 2. 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">?firstName=<em class="replaceable"><code>Carlos</code></em>&amp;lastName=<em class="replaceable"><code>Salazar</code></em>&amp;email=<em class="replaceable"><code>recipient%40example.com</code></em>&amp;endpointId=<em class="replaceable"><code>12345</code></em></code></pre>
                           <p>When you add these attributes to the end of the URL and press Enter, the
                              page updates to include the information in the attribute string. The form
                              should resemble the example in the following image.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="images/Email_Prefs_Tutorial_Test_Step6.3.1_2.png" />
                              
                              
                           </div>
                           
                        </li>
                        <li>
                           
                           <p>On the form, use the toggle switches to opt the endpoint into all of the
                              topics, and then choose <b>Update preferences</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Wait for approximately one minute, and then proceed to the next
                              section.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     
                     <h3 id="tutorials-email-prefs-part-6-test-form-segment">Step 6.4.2: Check
                        the Opt Status of the Test Endpoint
                     </h3>
                     
                     <p>Now that you've submitted some test data, you can use the segmentation tool in the
                        Amazon Pinpoint console to make sure that the test data was handled properly.
                     </p>
                     
                     <p class="title"><b>To check the endpoint opt status</b></p>
                     <ol>
                        <li>
                           <p>Open the Amazon Pinpoint console at
                              <a href="https://console.aws.amazon.com/pinpoint/" target="_blank">https://console.aws.amazon.com/pinpoint/</a>.
                           </p>
                        </li>
                        <li>
                           
                           <p>On the <b>All projects</b> page, choose the project that you
                              created in <a href="tutorials-email-prefs-part-1-create-project" target="_blank">Step
                                 1.1</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the navigation pane, choose <b>Segments</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create a segment</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Under <b>Segment group 1</b>, choose <b>Add a
                                 filter</b>, and then choose <b>Filter by
                                 endpoint</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Choose an endpoint attribute</b>, and then choose
                              <b>ComingSoonOptStatus</b>. Set the value of the filter to
                              <b>OptIn</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Add an attribute or metric</b>. Add the
                              <b>DealOfTheDay</b> attribute to the filter, and set the
                              value to <b>OptIn</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Repeat the previous step for the two remaining opt topics:
                              <b>NewProductsOptStatus</b> and
                              <b>SpecialOffersOptStatus</b>.
                           </p>
                           
                           <p>When you finish, the <b>Segment estimate</b> section should
                              indicate that the number of <b>Eligible endpoints</b> and
                              <b>Total endpoints</b> are both 1. The page should
                              resemble the example shown in the following image.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="images/Email_Prefs_Tutorial_Test_Step6.3.2_8.png" />
                              
                              
                           </div>
                           
                        </li>
                     </ol>
                     
                     
                     
                     <h3 id="tutorials-email-prefs-part-6-test-form-unsub-all">Step 6.4.3: Test
                        the "Unsubscribe From All" Functionality
                     </h3>
                     
                     <p>Also make sure that the <b>Unsubscribe from all email
                           communications</b> button on the preferences form works properly. When a
                        customer chooses this button, their opt status for all topics is set to "OptOut".
                        Additionally, the OptOut attribute for the customer's endpoint record is set to
                        "ALL". This change prevents the endpoint from being included in segments that you
                        create in this project in the future.
                     </p>
                     
                     <p class="title"><b>To test the unsubscribe button</b></p>
                     <ol>
                        <li>
                           
                           <p>In a web browser, go to the location where you uploaded the preferences
                              page.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Add the following string to the end of the URL. Replace the values for
                              <em class="replaceable"><code>firstName</code></em>,
                              <em class="replaceable"><code>lastName</code></em>, and
                              <em class="replaceable"><code>endpointId</code></em> with the values that you specified
                              in Step 2. 
                           </p>
                           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"></div><div class="btn-dark-theme" title="Dark theme" title-dark="Dark theme" title-light="Light theme"></div></div><code class="nohighlight">?firstName=<em class="replaceable"><code>Carlos</code></em>&amp;lastName=<em class="replaceable"><code>Salazar</code></em>&amp;email=<em class="replaceable"><code>recipient%40example.com</code></em>&amp;endpointId=<em class="replaceable"><code>12345</code></em>&amp;t1=OptIn&amp;t2=OptIn&amp;t3=OptIn&amp;t4=OptIn</code></pre>
                           <p>When you add these attributes to the end of the URL and press Enter, the
                              page updates to include the information in the attribute string.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>On the form, choose <b>Unsubscribe from all email
                                 communications</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Wait for approximately one minute, and then proceed to the next
                              section.
                           </p>
                           
                        </li>
                     </ol>
                     
                     
                     
                     <h3 id="tutorials-email-prefs-part-6-test-form-unsub-all-test">Step 6.3.4: Check
                        the Opt Status of the Test Endpoint
                     </h3>
                     
                     <p>The final step in testing the preference form is to confirm that unsubscribe
                        requests are handled properly. In this section, you use the segmentation tool in the
                        Amazon Pinpoint console to ensure that your test endpoint is opted out of email communications
                        that are sent from the current Amazon Pinpoint project.
                     </p>
                     
                     <p class="title"><b>To check the endpoint opt status</b></p>
                     <ol>
                        <li>
                           <p>Open the Amazon Pinpoint console at
                              <a href="https://console.aws.amazon.com/pinpoint/" target="_blank">https://console.aws.amazon.com/pinpoint/</a>.
                           </p>
                        </li>
                        <li>
                           
                           <p>On the <b>All projects</b> page, choose the project that you
                              created in <a href="tutorials-email-prefs-part-1-create-project" target="_blank">Step
                                 1.1</a>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>In the navigation pane, choose <b>Segments</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Choose <b>Create a segment</b>.
                           </p>
                           
                        </li>
                        <li>
                           
                           <p>Note the values in the <b>Segment estimate</b> section. This
                              section should indicate that the number of <b>Eligible
                                 endpoints</b> is 0, and the number of <b>Total
                                 endpoints</b> is 1. The page should resemble the example shown in
                              the following image.
                           </p>
                           
                           <div class="mediaobject">
                              
                              <img src="images/Email_Prefs_Tutorial_Test_Step6.3.4_5.png" />
                              
                              
                           </div>
                           
                        </li>
                     </ol>
                     
                     
                     
                     <h3 id="tutorials-email-prefs-part-6-test-form-troubleshooting">Troubleshooting the Form</h3>
                     
                     <p>If you perform these test steps, but the data in your Amazon Pinpoint project doesn't
                        change, there are a few steps that you can take to troubleshoot the issue:
                     </p>
                     
                     <div class="itemizedlist">
                        
                        
                        
                        
                        <ul class="itemizedlist" type="disc">
                           <li class="listitem">
                              
                              <p>In the Amazon Pinpoint console, make sure that you're using the correct AWS
                                 Region. Segments and endpoints aren't shared between Regions.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>In the Lambda console, open the function that you created in <a href="tutorials-email-prefs-part-4.html">Step 4</a>. On the
                                 <b>Monitoring</b> tab, choose <b>View logs in
                                    CloudWatch</b>.
                              </p>
                              
                              <p>Under <b>Log Streams</b>, choose the most recently logged
                                 event. Check the output of the event for more information about the issue.
                                 For example, if you see an "AccessDeniedException" error in the logs, make
                                 sure that the Amazon Pinpoint project ID and AWS Region that you entered in <a href="tutorials-email-prefs-part-4.html">Step 4</a> are equal to the
                                 project ID and Region values that you specified in the IAM policy in <a href="tutorials-email-prefs-part-3.html#tutorials-email-prefs-part-3-create-policy">Step 3.1</a>. If
                                 you recently changed these values, wait for a few minutes, and then try
                                 again.
                              </p>
                              
                           </li>
                           <li class="listitem">
                              
                              <p>If CloudWatch doesn't contain any logged information for the function, make sure
                                 that CORS is enabled in API Gateway, and that the API is deployed. If you're
                                 unsure, repeat the steps in <a href="tutorials-email-prefs-part-5.html#tutorials-email-prefs-part-5-deploy-api">Step
                                    5.3</a>.
                              </p>
                              
                           </li>
                        </ul>
                     </div>
                     
                     
                     <p><b>Next</b>: <a href="tutorials-email-prefs-part-7.html">Create and Send Amazon Pinpoint Campaigns</a></p>
                  </div>
                  <noscript>
                     <div>
                        <div>
                           <div>
                              <div id="js_error_message">
                                 <p><img src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png" alt="Warning" /> <strong>Javascript is disabled or is unavailable in your browser.</strong></p>
                                 <p>To use the AWS Documentation, Javascript must be enabled. Please refer to your browser's
                                    Help pages for instructions.
                                 </p>
                              </div>
                           </div>
                        </div>
                     </div>
                  </noscript>
                  <div id="main-col-footer">
                     <div id="doc-conventions"><a target="_top" href="/general/latest/gr/docconventions.html">Document Conventions</a></div>
                     <div id="next"><a class="awstoc" accesskey="p" href="tutorials-email-prefs-part-5.html">« Previous </a><a class="awstoc" accesskey="n" href="tutorials-email-prefs-part-7.html">Next »</a></div>
                     <div id="copyright-main-footer">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</div>
                  </div>
               </div>
            </div>
            <div id="right-expanded">
               <div id="right-content-wrapper">
                  <div id="pagetoc">
                     <p>On this page:</p>
                     <ul class="pagetoc">
                        <li class="pagetoc" name="Step 6.1: Create the&#xA;                JavaScript Form Handler"><a class="pagetoc" href="#tutorials-email-prefs-part-6-create-form-handler">Create
                              the JavaScript Form Handler</a></li>
                        <li class="pagetoc" name="Step 6.2: Create the Form&#xA;                File"><a class="pagetoc" href="#tutorials-email-prefs-part-6-create-form">Create the
                              Form</a></li>
                        <li class="pagetoc" name="Step 6.3: Upload the Form&#xA;                Files"><a class="pagetoc" href="#tutorials-email-prefs-part-6-upload-form">Upload the
                              Form</a></li>
                        <li class="pagetoc" name="Step 6.4: Test the Form"><a class="pagetoc" href="#tutorials-email-prefs-part-6-test-form">Test the
                              Form</a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="cookie-notice">
         <div class="cookie-notice-text">We use cookies to provide and improve our services. By using our site, you consent
            to cookies. <a href="http://aws.amazon.com/legal/cookies">Learn more</a></div>
      </div>
      <div id="footer">
         <div id="footer_short_fb" class="hide" title="Feedback"><a target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=tutorials-email-prefs-part-6"><i class="awsdocs-footer-text fa fa-envelope-o"></i></a></div>
         <div id="footer_toggle" class="mediaobject">
            <div id="footer_toggle_img" class="awsdocs-footer-text fa fa-caret-down"></div>
            <div id="footer_toggle_img_collapse" class="hide awsdocs-footer-text fa fa-caret-right"></div>
         </div>
         <div id="footer-left"><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/terms">Terms of Use</a><span class="awsdocs-footer-text"> | </span><a class="awsdocs-footer-text" target="_top" href="http://aws.amazon.com/privacy">Privacy</a><span class="awsdocs-footer-text"> | </span><span class="awsdocs-footer-text">© 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.</span></div>
         <div id="footer-right">
            <div id="feedback">
               <div id="forums"><a id="forum_link" target="_blank" href="http://forums.aws.amazon.com/forum.jspa?forumID=225" class="awsdocs-footer-text">Have a question? Try the Forums.</a></div>
               <div id="feedback-message" class="awsdocs-footer-text">Did this page help you?</div>
               <div id="feedback-yesno-buttons"><a class="awstoc btn btn-default" target="_blank" href="feedbackyes.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">Yes</a><a class="awstoc btn btn-default" target="_blank" href="feedbackno.html?topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html">No</a></div>
               <div id="feedback-feedback-button"><a class="awstoc btn btn-default" target="_blank" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Pinpoint&amp;topic_url=http://docs.aws.amazon.com/en_us/pinpoint/latest/developerguide/tutorials-email-prefs-part-6.html&amp;hidden_guide_name=Developer Guide&amp;hidden_api_version=&amp;hidden_file_name=tutorials-email-prefs-part-6">Feedback</a></div>
            </div>
         </div>
      </div>
      <!-- SiteCatalyst code version: H.25.2.
            Copyright 1996-2012 Adobe, Inc. All Rights Reserved
            More info available at http://www.omniture.com --><script language="JavaScript" type="text/javascript" src="https://a0.awsstatic.com/s_code/js/1.0/awshome_s_code.js"></script><script language="JavaScript" type="text/javascript">
         <!--

            // Documentation Service Name
            s.prop66='Amazon Pinpoint';
            s.eVar66='D=c66';
  
            // Documentation Guide Name                                                                 
            s.prop65='Developer Guide';
            s.eVar65='D=c65';

            var s_code=s.t();if(s_code)document.write(s_code)//--></script><script language="JavaScript" type="text/javascript">
         <!--
                if(navigator.appVersion.indexOf('MSIE')>=0)document.write(unescape('%3C')+'\!-'+'-')
                //--></script><noscript><img src="https://amazonwebservices.d2.sc.omtrdc.net/b/ss/awsamazondev/1/H.25.2--NS/0" height="1" width="1" border="0" alt="" /></noscript>
      <!--/DO NOT REMOVE/-->
      <!-- End SiteCatalyst code version: H.25.2. -->
   </body>
</html>